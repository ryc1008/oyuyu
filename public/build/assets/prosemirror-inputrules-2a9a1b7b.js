import{P as m}from"./prosemirror-state-d26f883c.js";import{f as x,a as I}from"./prosemirror-transform-7d6a52dd.js";class h{constructor(l,e){this.match=l,this.match=l,this.handler=typeof e=="string"?R(e):e}}function R(u){return function(l,e,t,o){let n=u;if(e[1]){let r=e[0].lastIndexOf(e[1]);n+=e[0].slice(r+e[1].length),t+=r;let i=t-o;i>0&&(n=e[0].slice(r-i,r)+n,t=o)}return l.tr.insertText(n,t,o)}}const M=500;function O({rules:u}){let l=new m({state:{init(){return null},apply(e,t){let o=e.getMeta(this);return o||(e.selectionSet||e.docChanged?null:t)}},props:{handleTextInput(e,t,o,n){return g(e,t,o,n,u,l)},handleDOMEvents:{compositionend:e=>{setTimeout(()=>{let{$cursor:t}=e.state.selection;t&&g(e,t.pos,t.pos,"",u,l)})}}},isInputRules:!0});return l}function g(u,l,e,t,o,n){if(u.composing)return!1;let r=u.state,i=r.doc.resolve(l);if(i.parent.type.spec.code)return!1;let s=i.parent.textBetween(Math.max(0,i.parentOffset-M),i.parentOffset,null,"ï¿¼")+t;for(let f=0;f<o.length;f++){let c=o[f].match.exec(s),p=c&&o[f].handler(r,c,l-(c[0].length-t.length),e);if(p)return u.dispatch(p.setMeta(n,{transform:p,from:l,to:e,text:t})),!0}return!1}const b=(u,l)=>{let e=u.plugins;for(let t=0;t<e.length;t++){let o=e[t],n;if(o.spec.isInputRules&&(n=o.getState(u))){if(l){let r=u.tr,i=n.transform;for(let s=i.steps.length-1;s>=0;s--)r.step(i.steps[s].invert(i.docs[s]));if(n.text){let s=r.doc.resolve(n.from).marks();r.replaceWith(n.from,n.to,u.schema.text(n.text,s))}else r.delete(n.from,n.to);l(r)}return!0}}return!1};function v(u,l,e=null,t){return new h(u,(o,n,r,i)=>{let s=e instanceof Function?e(n):e,f=o.tr.delete(r,i),c=f.doc.resolve(r),p=c.blockRange(),d=p&&x(p,l,s);if(!d)return null;f.wrap(p,d);let a=f.doc.resolve(r-1).nodeBefore;return a&&a.type==l&&I(f.doc,r-1)&&(!t||t(n,a))&&f.join(r-1),f})}function y(u,l,e=null){return new h(u,(t,o,n,r)=>{let i=t.doc.resolve(n),s=e instanceof Function?e(o):e;return i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),l)?t.tr.delete(n,r).setBlockType(n,n,l,s):null})}export{h as I,O as i,y as t,b as u,v as w};
