import{r as Oe}from"./prosemirror-state-d26f883c.js";import{r as Ee}from"./prosemirror-view-329e6b0d.js";import{r as Le}from"./prosemirror-model-2d5d1d45.js";import{e as xe}from"./prosemirror-transform-7d6a52dd.js";import{r as Ke}from"./prosemirror-keymap-a3c7cf8f.js";var m={};Object.defineProperty(m,"__esModule",{value:!0});var S=Oe,Y=Ee,M=Le,qe=xe,Ve=Ke,re,ne;if(typeof WeakMap<"u"){var de=new WeakMap;re=function(t){return de.get(t)},ne=function(t,e){return de.set(t,e),e}}else{var x=[],We=10,W=0;re=function(t){for(var e=0;e<x.length;e+=2)if(x[e]==t)return x[e+1]},ne=function(t,e){return W==We&&(W=0),x[W++]=t,x[W++]=e}}var L=function(e,n,r,a){this.left=e,this.top=n,this.right=r,this.bottom=a},C=function(e,n,r,a){this.width=e,this.height=n,this.map=r,this.problems=a};C.prototype.findCell=function(e){for(var n=this,r=0;r<this.map.length;r++){var a=n.map[r];if(a==e){for(var o=r%n.width,i=r/n.width|0,s=o+1,l=i+1,f=1;s<this.width&&this.map[r+f]==a;f++)s++;for(var u=1;l<this.height&&this.map[r+this.width*u]==a;u++)l++;return new L(o,i,s,l)}}throw new RangeError("No cell with offset "+e+" found")};C.prototype.colCount=function(e){for(var n=this,r=0;r<this.map.length;r++)if(n.map[r]==e)return r%n.width;throw new RangeError("No cell with offset "+e+" found")};C.prototype.nextCell=function(e,n,r){var a=this.findCell(e),o=a.left,i=a.right,s=a.top,l=a.bottom;return n=="horiz"?(r<0?o==0:i==this.width)?null:this.map[s*this.width+(r<0?o-1:i)]:(r<0?s==0:l==this.height)?null:this.map[o+this.width*(r<0?s-1:l)]};C.prototype.rectBetween=function(e,n){var r=this.findCell(e),a=r.left,o=r.right,i=r.top,s=r.bottom,l=this.findCell(n),f=l.left,u=l.right,p=l.top,d=l.bottom;return new L(Math.min(a,f),Math.min(i,p),Math.max(o,u),Math.max(s,d))};C.prototype.cellsInRect=function(e){for(var n=this,r=[],a={},o=e.top;o<e.bottom;o++)for(var i=e.left;i<e.right;i++){var s=o*n.width+i,l=n.map[s];a[l]||(a[l]=!0,(i!=e.left||!i||n.map[s-1]!=l)&&(o!=e.top||!o||n.map[s-n.width]!=l)&&r.push(l))}return r};C.prototype.positionAt=function(e,n,r){for(var a=this,o=0,i=0;;o++){var s=i+r.child(o).nodeSize;if(o==e){for(var l=n+e*a.width,f=(e+1)*a.width;l<f&&this.map[l]<i;)l++;return l==f?s-1:a.map[l]}i=s}};C.get=function(e){return re(e)||ne(e,Ie(e))};function Ie(t){if(t.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+t.type.name);for(var e=Xe(t),n=t.childCount,r=[],a=0,o=null,i=[],s=0,l=e*n;s<l;s++)r[s]=0;for(var f=0,u=0;f<n;f++){var p=t.child(f);u++;for(var d=0;;d++){for(;a<r.length&&r[a]!=0;)a++;if(d==p.childCount)break;for(var h=p.child(d),c=h.attrs,v=c.colspan,g=c.rowspan,y=c.colwidth,w=0;w<g;w++){if(w+f>=n){(o||(o=[])).push({type:"overlong_rowspan",pos:u,n:g-w});break}for(var T=a+w*e,A=0;A<v;A++){r[T+A]==0?r[T+A]=u:(o||(o=[])).push({type:"collision",row:f,pos:u,n:v-A});var _=y&&y[A];if(_){var N=(T+A)%e*2,F=i[N];F==null||F!=_&&i[N+1]==1?(i[N]=_,i[N+1]=1):F==_&&i[N+1]++}}}a+=v,u+=h.nodeSize}for(var j=(f+1)*e,$=0;a<j;)r[a++]==0&&$++;$&&(o||(o=[])).push({type:"missing",row:f,n:$}),u++}for(var pe=new C(e,n,r,o),ee=!1,V=0;!ee&&V<i.length;V+=2)i[V]!=null&&i[V+1]<n&&(ee=!0);return ee&&Je(pe,i,t),pe}function Xe(t){for(var e=-1,n=!1,r=0;r<t.childCount;r++){var a=t.child(r),o=0;if(n)for(var i=0;i<r;i++)for(var s=t.child(i),l=0;l<s.childCount;l++){var f=s.child(l);i+f.attrs.rowspan>r&&(o+=f.attrs.colspan)}for(var u=0;u<a.childCount;u++){var p=a.child(u);o+=p.attrs.colspan,p.attrs.rowspan>1&&(n=!0)}e==-1?e=o:e!=o&&(e=Math.max(e,o))}return e}function Je(t,e,n){t.problems||(t.problems=[]);for(var r=0,a={};r<t.map.length;r++){var o=t.map[r];if(!a[o]){a[o]=!0;for(var i=n.nodeAt(o),s=null,l=0;l<i.attrs.colspan;l++){var f=(r+l)%t.width,u=e[f*2];u!=null&&(!i.attrs.colwidth||i.attrs.colwidth[l]!=u)&&((s||(s=Ue(i.attrs)))[l]=u)}s&&t.problems.unshift({type:"colwidth mismatch",pos:o,colwidth:s})}}}function Ue(t){if(t.colwidth)return t.colwidth.slice();for(var e=[],n=0;n<t.colspan;n++)e.push(0);return e}var H=new S.PluginKey("selectingCells");function E(t){for(var e=t.depth-1;e>0;e--)if(t.node(e).type.spec.tableRole=="row")return t.node(0).resolve(t.before(e+1));return null}function Ye(t){for(var e=t.depth;e>0;e--){var n=t.node(e).type.spec.tableRole;if(n==="cell"||n==="header_cell")return t.node(e)}return null}function D(t){for(var e=t.selection.$head,n=e.depth;n>0;n--)if(e.node(n).type.spec.tableRole=="row")return!0;return!1}function q(t){var e=t.selection;return e.$anchorCell?e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell:e.node&&e.node.type.spec.tableRole=="cell"?e.$anchor:E(e.$head)||Ge(e.$head)}function Ge(t){for(var e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){var r=e.type.spec.tableRole;if(r=="cell"||r=="header_cell")return t.doc.resolve(n)}for(var a=t.nodeBefore,o=t.pos;a;a=a.lastChild,o--){var i=a.type.spec.tableRole;if(i=="cell"||i=="header_cell")return t.doc.resolve(o-a.nodeSize)}}function ae(t){return t.parent.type.spec.tableRole=="row"&&t.nodeAfter}function ye(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function P(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function Pe(t){return C.get(t.node(-1)).findCell(t.pos-t.start(-1))}function Qe(t){return C.get(t.node(-1)).colCount(t.pos-t.start(-1))}function le(t,e,n){var r=t.start(-1),a=C.get(t.node(-1)),o=a.nextCell(t.pos-r,e,n);return o==null?null:t.node(0).resolve(r+o)}function R(t,e,n){var r={};for(var a in t)r[a]=t[a];return r[e]=n,r}function O(t,e,n){n===void 0&&(n=1);var r=R(t,"colspan",t.colspan-n);return r.colwidth&&(r.colwidth=r.colwidth.slice(),r.colwidth.splice(e,n),r.colwidth.some(function(a){return a>0})||(r.colwidth=null)),r}function Ae(t,e,n){n===void 0&&(n=1);var r=R(t,"colspan",t.colspan+n);if(r.colwidth){r.colwidth=r.colwidth.slice();for(var a=0;a<n;a++)r.colwidth.splice(e,0,0)}return r}var b=function(t){function e(n,r){r===void 0&&(r=n);var a=n.node(-1),o=C.get(a),i=n.start(-1),s=o.rectBetween(n.pos-i,r.pos-i),l=n.node(0),f=o.cellsInRect(s).filter(function(p){return p!=r.pos-i});f.unshift(r.pos-i);var u=f.map(function(p){var d=a.nodeAt(p),h=p+i+1;return new S.SelectionRange(l.resolve(h),l.resolve(h+d.content.size))});t.call(this,u[0].$from,u[0].$to,u),this.$anchorCell=n,this.$headCell=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(r,a){var o=r.resolve(a.map(this.$anchorCell.pos)),i=r.resolve(a.map(this.$headCell.pos));if(ae(o)&&ae(i)&&P(o,i)){var s=this.$anchorCell.node(-1)!=o.node(-1);return s&&this.isRowSelection()?e.rowSelection(o,i):s&&this.isColSelection()?e.colSelection(o,i):new e(o,i)}return S.TextSelection.between(o,i)},e.prototype.content=function(){for(var r=this.$anchorCell.node(-1),a=C.get(r),o=this.$anchorCell.start(-1),i=a.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o),s={},l=[],f=i.top;f<i.bottom;f++){for(var u=[],p=f*a.width+i.left,d=i.left;d<i.right;d++,p++){var h=a.map[p];if(!s[h]){s[h]=!0;var c=a.findCell(h),v=r.nodeAt(h),g=i.left-c.left,y=c.right-i.right;if(g>0||y>0){var w=v.attrs;g>0&&(w=O(w,0,g)),y>0&&(w=O(w,w.colspan-y,y)),c.left<i.left?v=v.type.createAndFill(w):v=v.type.create(w,v.content)}if(c.top<i.top||c.bottom>i.bottom){var T=R(v.attrs,"rowspan",Math.min(c.bottom,i.bottom)-Math.max(c.top,i.top));c.top<i.top?v=v.type.createAndFill(T):v=v.type.create(T,v.content)}u.push(v)}}l.push(r.child(f).copy(M.Fragment.from(u)))}var A=this.isColSelection()&&this.isRowSelection()?r:l;return new M.Slice(M.Fragment.from(A),1,1)},e.prototype.replace=function(r,a){a===void 0&&(a=M.Slice.empty);for(var o=r.steps.length,i=this.ranges,s=0;s<i.length;s++){var l=i[s],f=l.$from,u=l.$to,p=r.mapping.slice(o);r.replace(p.map(f.pos),p.map(u.pos),s?M.Slice.empty:a)}var d=t.findFrom(r.doc.resolve(r.mapping.slice(o).map(this.to)),-1);d&&r.setSelection(d)},e.prototype.replaceWith=function(r,a){this.replace(r,new M.Slice(M.Fragment.from(a),0,0))},e.prototype.forEachCell=function(r){for(var a=this.$anchorCell.node(-1),o=C.get(a),i=this.$anchorCell.start(-1),s=o.cellsInRect(o.rectBetween(this.$anchorCell.pos-i,this.$headCell.pos-i)),l=0;l<s.length;l++)r(a.nodeAt(s[l]),i+s[l])},e.prototype.isColSelection=function(){var r=this.$anchorCell.index(-1),a=this.$headCell.index(-1);if(Math.min(r,a)>0)return!1;var o=r+this.$anchorCell.nodeAfter.attrs.rowspan,i=a+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(o,i)==this.$headCell.node(-1).childCount},e.colSelection=function(r,a){a===void 0&&(a=r);var o=C.get(r.node(-1)),i=r.start(-1),s=o.findCell(r.pos-i),l=o.findCell(a.pos-i),f=r.node(0);return s.top<=l.top?(s.top>0&&(r=f.resolve(i+o.map[s.left])),l.bottom<o.height&&(a=f.resolve(i+o.map[o.width*(o.height-1)+l.right-1]))):(l.top>0&&(a=f.resolve(i+o.map[l.left])),s.bottom<o.height&&(r=f.resolve(i+o.map[o.width*(o.height-1)+s.right-1]))),new e(r,a)},e.prototype.isRowSelection=function(){var r=C.get(this.$anchorCell.node(-1)),a=this.$anchorCell.start(-1),o=r.colCount(this.$anchorCell.pos-a),i=r.colCount(this.$headCell.pos-a);if(Math.min(o,i)>0)return!1;var s=o+this.$anchorCell.nodeAfter.attrs.colspan,l=i+this.$headCell.nodeAfter.attrs.colspan;return Math.max(s,l)==r.width},e.prototype.eq=function(r){return r instanceof e&&r.$anchorCell.pos==this.$anchorCell.pos&&r.$headCell.pos==this.$headCell.pos},e.rowSelection=function(r,a){a===void 0&&(a=r);var o=C.get(r.node(-1)),i=r.start(-1),s=o.findCell(r.pos-i),l=o.findCell(a.pos-i),f=r.node(0);return s.left<=l.left?(s.left>0&&(r=f.resolve(i+o.map[s.top*o.width])),l.right<o.width&&(a=f.resolve(i+o.map[o.width*(l.top+1)-1]))):(l.left>0&&(a=f.resolve(i+o.map[l.top*o.width])),s.right<o.width&&(r=f.resolve(i+o.map[o.width*(s.top+1)-1]))),new e(r,a)},e.prototype.toJSON=function(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}},e.fromJSON=function(r,a){return new e(r.resolve(a.anchor),r.resolve(a.head))},e.create=function(r,a,o){return o===void 0&&(o=a),new e(r.resolve(a),r.resolve(o))},e.prototype.getBookmark=function(){return new G(this.$anchorCell.pos,this.$headCell.pos)},e}(S.Selection);b.prototype.visible=!1;S.Selection.jsonID("cell",b);var G=function(e,n){this.anchor=e,this.head=n};G.prototype.map=function(e){return new G(e.map(this.anchor),e.map(this.head))};G.prototype.resolve=function(e){var n=e.resolve(this.anchor),r=e.resolve(this.head);return n.parent.type.spec.tableRole=="row"&&r.parent.type.spec.tableRole=="row"&&n.index()<n.parent.childCount&&r.index()<r.parent.childCount&&P(n,r)?new b(n,r):S.Selection.near(r,1)};function Ze(t){if(!(t.selection instanceof b))return null;var e=[];return t.selection.forEachCell(function(n,r){e.push(Y.Decoration.node(r,r+n.nodeSize,{class:"selectedCell"}))}),Y.DecorationSet.create(t.doc,e)}function je(t){var e=t.$from,n=t.$to;if(e.pos==n.pos||e.pos<e.pos-6)return!1;for(var r=e.pos,a=n.pos,o=e.depth;o>=0&&!(e.after(o+1)<e.end(o));o--,r++);for(var i=n.depth;i>=0&&!(n.before(i+1)>n.start(i));i--,a--);return r==a&&/row|table/.test(e.node(o).type.spec.tableRole)}function $e(t){for(var e=t.$from,n=t.$to,r,a,o=e.depth;o>0;o--){var i=e.node(o);if(i.type.spec.tableRole==="cell"||i.type.spec.tableRole==="header_cell"){r=i;break}}for(var s=n.depth;s>0;s--){var l=n.node(s);if(l.type.spec.tableRole==="cell"||l.type.spec.tableRole==="header_cell"){a=l;break}}return r!==a&&n.parentOffset===0}function et(t,e,n){var r=(e||t).selection,a=(e||t).doc,o,i;if(r instanceof S.NodeSelection&&(i=r.node.type.spec.tableRole)){if(i=="cell"||i=="header_cell")o=b.create(a,r.from);else if(i=="row"){var s=a.resolve(r.from+1);o=b.rowSelection(s,s)}else if(!n){var l=C.get(r.node),f=r.from+1,u=f+l.map[l.width*l.height-1];o=b.create(a,f+1,u)}}else r instanceof S.TextSelection&&je(r)?o=S.TextSelection.create(a,r.from):r instanceof S.TextSelection&&$e(r)&&(o=S.TextSelection.create(a,r.$from.start(),r.$from.end()));return o&&(e||(e=t.tr)).setSelection(o),e}function he(t,e){var n=t.getAttribute("data-colwidth"),r=n&&/^\d+(,\d+)*$/.test(n)?n.split(",").map(function(f){return Number(f)}):null,a=Number(t.getAttribute("colspan")||1),o={colspan:a,rowspan:Number(t.getAttribute("rowspan")||1),colwidth:r&&r.length==a?r:null};for(var i in e){var s=e[i].getFromDOM,l=s&&s(t);l!=null&&(o[i]=l)}return o}function ce(t,e){var n={};t.attrs.colspan!=1&&(n.colspan=t.attrs.colspan),t.attrs.rowspan!=1&&(n.rowspan=t.attrs.rowspan),t.attrs.colwidth&&(n["data-colwidth"]=t.attrs.colwidth.join(","));for(var r in e){var a=e[r].setDOMAttr;a&&a(t.attrs[r],n)}return n}function tt(t){var e=t.cellAttributes||{},n={colspan:{default:1},rowspan:{default:1},colwidth:{default:null}};for(var r in e)n[r]={default:e[r].default};return{table:{content:"table_row+",tableRole:"table",isolating:!0,group:t.tableGroup,parseDOM:[{tag:"table"}],toDOM:function(){return["table",["tbody",0]]}},table_row:{content:"(table_cell | table_header)*",tableRole:"row",parseDOM:[{tag:"tr"}],toDOM:function(){return["tr",0]}},table_cell:{content:t.cellContent,attrs:n,tableRole:"cell",isolating:!0,parseDOM:[{tag:"td",getAttrs:function(a){return he(a,e)}}],toDOM:function(o){return["td",ce(o,e),0]}},table_header:{content:t.cellContent,attrs:n,tableRole:"header_cell",isolating:!0,parseDOM:[{tag:"th",getAttrs:function(a){return he(a,e)}}],toDOM:function(o){return["th",ce(o,e),0]}}}}function z(t){var e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(var n in t.nodes){var r=t.nodes[n],a=r.spec.tableRole;a&&(e[a]=r)}}return e}function Me(t){if(!t.size)return null;for(var e=t.content,n=t.openStart,r=t.openEnd;e.childCount==1&&(n>0&&r>0||e.firstChild.type.spec.tableRole=="table");)n--,r--,e=e.firstChild.content;var a=e.firstChild,o=a.type.spec.tableRole,i=a.type.schema,s=[];if(o=="row")for(var l=0;l<e.childCount;l++){var f=e.child(l).content,u=l?0:Math.max(0,n-1),p=l<e.childCount-1?0:Math.max(0,r-1);(u||p)&&(f=oe(z(i).row,new M.Slice(f,u,p)).content),s.push(f)}else if(o=="cell"||o=="header_cell")s.push(n||r?oe(z(i).row,new M.Slice(e,n,r)).content:e);else return null;return rt(i,s)}function rt(t,e){for(var n=[],r=0;r<e.length;r++)for(var a=e[r],o=a.childCount-1;o>=0;o--)for(var i=a.child(o).attrs,s=i.rowspan,l=i.colspan,f=r;f<r+s;f++)n[f]=(n[f]||0)+l;for(var u=0,p=0;p<n.length;p++)u=Math.max(u,n[p]);for(var d=0;d<n.length;d++)if(d>=e.length&&e.push(M.Fragment.empty),n[d]<u){for(var h=z(t).cell.createAndFill(),c=[],v=n[d];v<u;v++)c.push(h);e[d]=e[d].append(M.Fragment.from(c))}return{height:e.length,width:u,rows:e}}function oe(t,e){var n=t.createAndFill(),r=new qe.Transform(n).replace(0,n.content.size,e);return r.doc}function Re(t,e,n){var r=t.width,a=t.height,o=t.rows;if(r!=e){for(var i=[],s=[],l=0;l<o.length;l++){for(var f=o[l],u=[],p=i[l]||0,d=0;p<e;d++){var h=f.child(d%f.childCount);p+h.attrs.colspan>e&&(h=h.type.create(O(h.attrs,h.attrs.colspan,p+h.attrs.colspan-e),h.content)),u.push(h),p+=h.attrs.colspan;for(var c=1;c<h.attrs.rowspan;c++)i[l+c]=(i[l+c]||0)+h.attrs.colspan}s.push(M.Fragment.from(u))}o=s,r=e}if(a!=n){for(var v=[],g=0,y=0;g<n;g++,y++){for(var w=[],T=o[y%a],A=0;A<T.childCount;A++){var _=T.child(A);g+_.attrs.rowspan>n&&(_=_.type.create(R(_.attrs,"rowspan",n-_.attrs.rowspan),_.content)),w.push(_)}v.push(M.Fragment.from(w))}o=v,a=n}return{width:r,height:a,rows:o}}function nt(t,e,n,r,a,o,i){var s=t.doc.type.schema,l=z(s),f,u;if(a>e.width)for(var p=0,d=0;p<e.height;p++){var h=n.child(p);d+=h.nodeSize;var c=[],v=void 0;h.lastChild==null||h.lastChild.type==l.cell?v=f||(f=l.cell.createAndFill()):v=u||(u=l.header_cell.createAndFill());for(var g=e.width;g<a;g++)c.push(v);t.insert(t.mapping.slice(i).map(d-1+r),c)}if(o>e.height){for(var y=[],w=0,T=(e.height-1)*e.width;w<Math.max(e.width,a);w++){var A=w>=e.width?!1:n.nodeAt(e.map[T+w]).type==l.header_cell;y.push(A?u||(u=l.header_cell.createAndFill()):f||(f=l.cell.createAndFill()))}for(var _=l.row.create(null,M.Fragment.from(y)),N=[],F=e.height;F<o;F++)N.push(_);t.insert(t.mapping.slice(i).map(r+n.nodeSize-2),N)}return!!(f||u)}function ve(t,e,n,r,a,o,i,s){if(i==0||i==e.height)return!1;for(var l=!1,f=a;f<o;f++){var u=i*e.width+f,p=e.map[u];if(e.map[u-e.width]==p){l=!0;var d=n.nodeAt(p),h=e.findCell(p),c=h.top,v=h.left;t.setNodeMarkup(t.mapping.slice(s).map(p+r),null,R(d.attrs,"rowspan",i-c)),t.insert(t.mapping.slice(s).map(e.positionAt(i,v,n)),d.type.createAndFill(R(d.attrs,"rowspan",c+d.attrs.rowspan-i))),f+=d.attrs.colspan-1}}return l}function me(t,e,n,r,a,o,i,s){if(i==0||i==e.width)return!1;for(var l=!1,f=a;f<o;f++){var u=f*e.width+i,p=e.map[u];if(e.map[u-1]==p){l=!0;var d=n.nodeAt(p),h=e.colCount(p),c=t.mapping.slice(s).map(p+r);t.setNodeMarkup(c,null,O(d.attrs,i-h,d.attrs.colspan-(i-h))),t.insert(c+d.nodeSize,d.type.createAndFill(O(d.attrs,0,i-h))),f+=d.attrs.rowspan-1}}return l}function ie(t,e,n,r,a){var o=n?t.doc.nodeAt(n-1):t.doc,i=C.get(o),s=r.top,l=r.left,f=l+a.width,u=s+a.height,p=t.tr,d=0;function h(){o=n?p.doc.nodeAt(n-1):p.doc,i=C.get(o),d=p.mapping.maps.length}nt(p,i,o,n,f,u,d)&&h(),ve(p,i,o,n,l,f,s,d)&&h(),ve(p,i,o,n,l,f,u,d)&&h(),me(p,i,o,n,s,u,l,d)&&h(),me(p,i,o,n,s,u,f,d)&&h();for(var c=s;c<u;c++){var v=i.positionAt(c,l,o),g=i.positionAt(c,f,o);p.replace(p.mapping.slice(d).map(v+n),p.mapping.slice(d).map(g+n),new M.Slice(a.rows[c-s],0,0))}h(),p.setSelection(new b(p.doc.resolve(n+i.positionAt(s,l,o)),p.doc.resolve(n+i.positionAt(u-1,f-1,o)))),e(p)}var at=Ve.keydownHandler({ArrowLeft:I("horiz",-1),ArrowRight:I("horiz",1),ArrowUp:I("vert",-1),ArrowDown:I("vert",1),"Shift-ArrowLeft":X("horiz",-1),"Shift-ArrowRight":X("horiz",1),"Shift-ArrowUp":X("vert",-1),"Shift-ArrowDown":X("vert",1),Backspace:J,"Mod-Backspace":J,Delete:J,"Mod-Delete":J});function U(t,e,n){return n.eq(t.selection)?!1:(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function I(t,e){return function(n,r,a){var o=n.selection;if(o instanceof b)return U(n,r,S.Selection.near(o.$headCell,e));if(t!="horiz"&&!o.empty)return!1;var i=ze(a,t,e);if(i==null)return!1;if(t=="horiz")return U(n,r,S.Selection.near(n.doc.resolve(o.head+e),e));var s=n.doc.resolve(i),l=le(s,t,e),f;return l?f=S.Selection.near(l,1):e<0?f=S.Selection.near(n.doc.resolve(s.before(-1)),-1):f=S.Selection.near(n.doc.resolve(s.after(-1)),1),U(n,r,f)}}function X(t,e){return function(n,r,a){var o=n.selection;if(!(o instanceof b)){var i=ze(a,t,e);if(i==null)return!1;o=new b(n.doc.resolve(i))}var s=le(o.$headCell,t,e);return s?U(n,r,new b(o.$anchorCell,s)):!1}}function J(t,e){var n=t.selection;if(!(n instanceof b))return!1;if(e){var r=t.tr,a=z(t.schema).cell.createAndFill().content;n.forEachCell(function(o,i){o.content.eq(a)||r.replace(r.mapping.map(i+1),r.mapping.map(i+o.nodeSize-1),new M.Slice(a,0,0))}),r.docChanged&&e(r)}return!0}function ot(t,e){var n=t.state.doc,r=E(n.resolve(e));return r?(t.dispatch(t.state.tr.setSelection(new b(r))),!0):!1}function _e(t,e,n){if(!D(t.state))return!1;var r=Me(n),a=t.state.selection;if(a instanceof b){r||(r={width:1,height:1,rows:[M.Fragment.from(oe(z(t.state.schema).cell,n))]});var o=a.$anchorCell.node(-1),i=a.$anchorCell.start(-1),s=C.get(o).rectBetween(a.$anchorCell.pos-i,a.$headCell.pos-i);return r=Re(r,s.right-s.left,s.bottom-s.top),ie(t.state,t.dispatch,i,s,r),!0}else if(r){var l=q(t.state),f=l.start(-1);return ie(t.state,t.dispatch,f,C.get(l.node(-1)).findCell(l.pos-f),r),!0}else return!1}function it(t,e){if(e.ctrlKey||e.metaKey)return;var n=ge(t,e.target),r;if(e.shiftKey&&t.state.selection instanceof b)a(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&n&&(r=E(t.state.selection.$anchor))!=null&&te(t,e).pos!=r.pos)a(r,e),e.preventDefault();else if(!n)return;function a(s,l){var f=te(t,l),u=H.getState(t.state)==null;if(!f||!P(s,f))if(u)f=s;else return;var p=new b(s,f);if(u||!t.state.selection.eq(p)){var d=t.state.tr.setSelection(p);u&&d.setMeta(H,s.pos),t.dispatch(d)}}function o(){t.root.removeEventListener("mouseup",o),t.root.removeEventListener("dragstart",o),t.root.removeEventListener("mousemove",i),H.getState(t.state)!=null&&t.dispatch(t.state.tr.setMeta(H,-1))}function i(s){var l=H.getState(t.state),f;if(l!=null)f=t.state.doc.resolve(l);else if(ge(t,s.target)!=n&&(f=te(t,e),!f))return o();f&&a(f,s)}t.root.addEventListener("mouseup",o),t.root.addEventListener("dragstart",o),t.root.addEventListener("mousemove",i)}function ze(t,e,n){if(!(t.state.selection instanceof S.TextSelection))return null;for(var r=t.state.selection,a=r.$head,o=a.depth-1;o>=0;o--){var i=a.node(o),s=n<0?a.index(o):a.indexAfter(o);if(s!=(n<0?0:i.childCount))return null;if(i.type.spec.tableRole=="cell"||i.type.spec.tableRole=="header_cell"){var l=a.before(o),f=e=="vert"?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(f)?l:null}}return null}function ge(t,e){for(;e&&e!=t.dom;e=e.parentNode)if(e.nodeName=="TD"||e.nodeName=="TH")return e}function te(t,e){var n=t.posAtCoords({left:e.clientX,top:e.clientY});return n&&n?E(t.state.doc.resolve(n.pos)):null}var Te=new S.PluginKey("fix-tables");function ke(t,e,n,r){var a=t.childCount,o=e.childCount;e:for(var i=0,s=0;i<o;i++){for(var l=e.child(i),f=s,u=Math.min(a,i+3);f<u;f++)if(t.child(f)==l){s=f+1,n+=l.nodeSize;continue e}r(l,n),s<a&&t.child(s).sameMarkup(l)?ke(t.child(s),l,n+1,r):l.nodesBetween(0,l.content.size,r,n+1),n+=l.nodeSize}}function De(t,e){var n,r=function(a,o){a.type.spec.tableRole=="table"&&(n=lt(t,a,o,n))};return e?e.doc!=t.doc&&ke(e.doc,t.doc,0,r):t.doc.descendants(r),n}function lt(t,e,n,r){var a=C.get(e);if(!a.problems)return r;r||(r=t.tr);for(var o=[],i=0;i<a.height;i++)o.push(0);for(var s=0;s<a.problems.length;s++){var l=a.problems[s];if(l.type=="collision"){for(var f=e.nodeAt(l.pos),u=0;u<f.attrs.rowspan;u++)o[l.row+u]+=l.n;r.setNodeMarkup(r.mapping.map(n+1+l.pos),null,O(f.attrs,f.attrs.colspan-l.n,l.n))}else if(l.type=="missing")o[l.row]+=l.n;else if(l.type=="overlong_rowspan"){var p=e.nodeAt(l.pos);r.setNodeMarkup(r.mapping.map(n+1+l.pos),null,R(p.attrs,"rowspan",p.attrs.rowspan-l.n))}else if(l.type=="colwidth mismatch"){var d=e.nodeAt(l.pos);r.setNodeMarkup(r.mapping.map(n+1+l.pos),null,R(d.attrs,"colwidth",l.colwidth))}}for(var h,c,v=0;v<o.length;v++)o[v]&&(h==null&&(h=v),c=v);for(var g=0,y=n+1;g<a.height;g++){var w=e.child(g),T=y+w.nodeSize,A=o[g];if(A>0){var _="cell";w.firstChild&&(_=w.firstChild.type.spec.tableRole);for(var N=[],F=0;F<A;F++)N.push(z(t.schema)[_].createAndFill());var j=(g==0||h==g-1)&&c==g?y+1:T-1;r.insert(r.mapping.map(j),N)}y=T}return r.setMeta(Te,{fixTables:!0})}function B(t){var e=t.selection,n=q(t),r=n.node(-1),a=n.start(-1),o=C.get(r),i;return e instanceof b?i=o.rectBetween(e.$anchorCell.pos-a,e.$headCell.pos-a):i=o.findCell(n.pos-a),i.tableStart=a,i.map=o,i.table=r,i}function st(t,e,n){for(var r=z(e.type.schema).header_cell,a=0;a<t.height;a++)if(e.nodeAt(t.map[n+a*t.width]).type!=r)return!1;return!0}function se(t,e,n){var r=e.map,a=e.tableStart,o=e.table,i=n>0?-1:0;st(r,o,n+i)&&(i=n==0||n==r.width?null:0);for(var s=0;s<r.height;s++){var l=s*r.width+n;if(n>0&&n<r.width&&r.map[l-1]==r.map[l]){var f=r.map[l],u=o.nodeAt(f);t.setNodeMarkup(t.mapping.map(a+f),null,Ae(u.attrs,n-r.colCount(f))),s+=u.attrs.rowspan-1}else{var p=i==null?z(o.type.schema).cell:o.nodeAt(r.map[l+i]).type,d=r.positionAt(s,n,o);t.insert(t.mapping.map(a+d),p.createAndFill())}}return t}function ft(t,e){if(!D(t))return!1;if(e){var n=B(t);e(se(t.tr,n,n.left))}return!0}function ut(t,e){if(!D(t))return!1;if(e){var n=B(t);e(se(t.tr,n,n.right))}return!0}function Ne(t,e,n){for(var r=e.map,a=e.table,o=e.tableStart,i=t.mapping.maps.length,s=0;s<r.height;){var l=s*r.width+n,f=r.map[l],u=a.nodeAt(f);if(n>0&&r.map[l-1]==f||n<r.width-1&&r.map[l+1]==f)t.setNodeMarkup(t.mapping.slice(i).map(o+f),null,O(u.attrs,n-r.colCount(f)));else{var p=t.mapping.slice(i).map(o+f);t.delete(p,p+u.nodeSize)}s+=u.attrs.rowspan}}function pt(t,e){if(!D(t))return!1;if(e){var n=B(t),r=t.tr;if(n.left==0&&n.right==n.map.width)return!1;for(var a=n.right-1;Ne(r,n,a),a!=n.left;a--)n.table=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc,n.map=C.get(n.table);e(r)}return!0}function dt(t,e,n){for(var r=z(e.type.schema).header_cell,a=0;a<t.width;a++)if(e.nodeAt(t.map[a+n*t.width]).type!=r)return!1;return!0}function fe(t,e,n){for(var r=e.map,a=e.tableStart,o=e.table,i=a,s=0;s<n;s++)i+=o.child(s).nodeSize;var l=[],f=n>0?-1:0;dt(r,o,n+f)&&(f=n==0||n==r.height?null:0);for(var u=0,p=r.width*n;u<r.width;u++,p++)if(n>0&&n<r.height&&r.map[p]==r.map[p-r.width]){var d=r.map[p],h=o.nodeAt(d).attrs;t.setNodeMarkup(a+d,null,R(h,"rowspan",h.rowspan+1)),u+=h.colspan-1}else{var c=f==null?z(o.type.schema).cell:o.nodeAt(r.map[p+f*r.width]).type;l.push(c.createAndFill())}return t.insert(i,z(o.type.schema).row.create(null,l)),t}function ht(t,e){if(!D(t))return!1;if(e){var n=B(t);e(fe(t.tr,n,n.top))}return!0}function ct(t,e){if(!D(t))return!1;if(e){var n=B(t);e(fe(t.tr,n,n.bottom))}return!0}function Be(t,e,n){for(var r=e.map,a=e.table,o=e.tableStart,i=0,s=0;s<n;s++)i+=a.child(s).nodeSize;var l=i+a.child(n).nodeSize,f=t.mapping.maps.length;t.delete(i+o,l+o);for(var u=0,p=n*r.width;u<r.width;u++,p++){var d=r.map[p];if(n>0&&d==r.map[p-r.width]){var h=a.nodeAt(d).attrs;t.setNodeMarkup(t.mapping.slice(f).map(d+o),null,R(h,"rowspan",h.rowspan-1)),u+=h.colspan-1}else if(n<r.width&&d==r.map[p+r.width]){var c=a.nodeAt(d),v=c.type.create(R(c.attrs,"rowspan",c.attrs.rowspan-1),c.content),g=r.positionAt(n+1,u,a);t.insert(t.mapping.slice(f).map(o+g),v),u+=c.attrs.colspan-1}}}function vt(t,e){if(!D(t))return!1;if(e){var n=B(t),r=t.tr;if(n.top==0&&n.bottom==n.map.height)return!1;for(var a=n.bottom-1;Be(r,n,a),a!=n.top;a--)n.table=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc,n.map=C.get(n.table);e(r)}return!0}function Ce(t){var e=t.content;return e.childCount==1&&e.firstChild.isTextblock&&e.firstChild.childCount==0}function mt(t,e){for(var n=t.width,r=t.height,a=t.map,o=e.top*n+e.left,i=o,s=(e.bottom-1)*n+e.left,l=o+(e.right-e.left-1),f=e.top;f<e.bottom;f++){if(e.left>0&&a[i]==a[i-1]||e.right<n&&a[l]==a[l+1])return!0;i+=n,l+=n}for(var u=e.left;u<e.right;u++){if(e.top>0&&a[o]==a[o-n]||e.bottom<r&&a[s]==a[s+n])return!0;o++,s++}return!1}function gt(t,e){var n=t.selection;if(!(n instanceof b)||n.$anchorCell.pos==n.$headCell.pos)return!1;var r=B(t),a=r.map;if(mt(a,r))return!1;if(e){for(var o=t.tr,i={},s=M.Fragment.empty,l,f,u=r.top;u<r.bottom;u++)for(var p=r.left;p<r.right;p++){var d=a.map[u*a.width+p],h=r.table.nodeAt(d);if(!i[d])if(i[d]=!0,l==null)l=d,f=h;else{Ce(h)||(s=s.append(h.content));var c=o.mapping.map(d+r.tableStart);o.delete(c,c+h.nodeSize)}}if(o.setNodeMarkup(l+r.tableStart,null,R(Ae(f.attrs,f.attrs.colspan,r.right-r.left-f.attrs.colspan),"rowspan",r.bottom-r.top)),s.size){var v=l+1+f.content.size,g=Ce(f)?l+1:v;o.replaceWith(g+r.tableStart,v+r.tableStart,s)}o.setSelection(new b(o.doc.resolve(l+r.tableStart))),e(o)}return!0}function Ct(t,e){var n=z(t.schema);return Fe(function(r){var a=r.node;return n[a.type.spec.tableRole]})(t,e)}function Fe(t){return function(e,n){var r=e.selection,a,o;if(r instanceof b){if(r.$anchorCell.pos!=r.$headCell.pos)return!1;a=r.$anchorCell.nodeAfter,o=r.$anchorCell.pos}else{if(a=Ye(r.$from),!a)return!1;o=E(r.$from).pos}if(a.attrs.colspan==1&&a.attrs.rowspan==1)return!1;if(n){var i=a.attrs,s=[],l=i.colwidth;i.rowspan>1&&(i=R(i,"rowspan",1)),i.colspan>1&&(i=R(i,"colspan",1));for(var f=B(e),u=e.tr,p=0;p<f.right-f.left;p++)s.push(l?R(i,"colwidth",l&&l[p]?[l[p]]:null):i);for(var d,h=f.top;h<f.bottom;h++){var c=f.map.positionAt(h,f.left,f.table);h==f.top&&(c+=a.nodeSize);for(var v=f.left,g=0;v<f.right;v++,g++)v==f.left&&h==f.top||u.insert(d=u.mapping.map(c+f.tableStart,1),t({node:a,row:h,col:v}).createAndFill(s[g]))}u.setNodeMarkup(o,t({node:a,row:f.top,col:f.left}),s[0]),r instanceof b&&u.setSelection(new b(u.doc.resolve(r.$anchorCell.pos),d&&u.doc.resolve(d))),n(u)}return!0}}function wt(t,e){return function(n,r){if(!D(n))return!1;var a=q(n);if(a.nodeAfter.attrs[t]===e)return!1;if(r){var o=n.tr;n.selection instanceof b?n.selection.forEachCell(function(i,s){i.attrs[t]!==e&&o.setNodeMarkup(s,null,R(i.attrs,t,e))}):o.setNodeMarkup(a.pos,null,R(a.nodeAfter.attrs,t,e)),r(o)}return!0}}function bt(t){return function(e,n){if(!D(e))return!1;if(n){for(var r=z(e.schema),a=B(e),o=e.tr,i=a.map.cellsInRect(t=="column"?new L(a.left,0,a.right,a.map.height):t=="row"?new L(0,a.top,a.map.width,a.bottom):a),s=i.map(function(u){return a.table.nodeAt(u)}),l=0;l<i.length;l++)s[l].type==r.header_cell&&o.setNodeMarkup(a.tableStart+i[l],r.cell,s[l].attrs);if(o.steps.length==0)for(var f=0;f<i.length;f++)o.setNodeMarkup(a.tableStart+i[f],r.header_cell,s[f].attrs);n(o)}return!0}}function we(t,e,n){for(var r=e.map.cellsInRect({left:0,top:0,right:t=="row"?e.map.width:1,bottom:t=="column"?e.map.height:1}),a=0;a<r.length;a++){var o=e.table.nodeAt(r[a]);if(o&&o.type!==n.header_cell)return!1}return!0}function Q(t,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?bt(t):function(n,r){if(!D(n))return!1;if(r){var a=z(n.schema),o=B(n),i=n.tr,s=we("row",o,a),l=we("column",o,a),f=t==="column"?s:t==="row"?l:!1,u=f?1:0,p=t=="column"?new L(0,u,1,o.map.height):t=="row"?new L(u,0,o.map.width,1):o,d=t=="column"?l?a.cell:a.header_cell:t=="row"?s?a.cell:a.header_cell:a.cell;o.map.cellsInRect(p).forEach(function(h){var c=h+o.tableStart,v=i.doc.nodeAt(c);v&&i.setNodeMarkup(c,d,v.attrs)}),r(i)}return!0}}var St=Q("row",{useDeprecatedLogic:!0}),yt=Q("column",{useDeprecatedLogic:!0}),At=Q("cell",{useDeprecatedLogic:!0});function Mt(t,e){if(e<0){var n=t.nodeBefore;if(n)return t.pos-n.nodeSize;for(var r=t.index(-1)-1,a=t.before();r>=0;r--){var o=t.node(-1).child(r);if(o.childCount)return a-1-o.lastChild.nodeSize;a-=o.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;for(var i=t.node(-1),s=t.indexAfter(-1),l=t.after();s<i.childCount;s++){var f=i.child(s);if(f.childCount)return l+1;l+=f.nodeSize}}}function Rt(t){return function(e,n){if(!D(e))return!1;var r=Mt(q(e),t);if(r!=null){if(n){var a=e.doc.resolve(r);n(e.tr.setSelection(S.TextSelection.between(a,ye(a))).scrollIntoView())}return!0}}}function _t(t,e){for(var n=t.selection.$anchor,r=n.depth;r>0;r--){var a=n.node(r);if(a.type.spec.tableRole=="table")return e&&e(t.tr.delete(n.before(r),n.after(r)).scrollIntoView()),!0}return!1}var ue=function(e,n){this.node=e,this.cellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Z(e,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))};ue.prototype.update=function(e){return e.type!=this.node.type?!1:(this.node=e,Z(e,this.colgroup,this.table,this.cellMinWidth),!0)};ue.prototype.ignoreMutation=function(e){return e.type=="attributes"&&(e.target==this.table||this.colgroup.contains(e.target))};function Z(t,e,n,r,a,o){for(var i=0,s=!0,l=e.firstChild,f=t.firstChild,u=0,p=0;u<f.childCount;u++)for(var d=f.child(u).attrs,h=d.colspan,c=d.colwidth,v=0;v<h;v++,p++){var g=a==p?o:c&&c[v],y=g?g+"px":"";i+=g||r,g||(s=!1),l?(l.style.width!=y&&(l.style.width=y),l=l.nextSibling):e.appendChild(document.createElement("col")).style.width=y}for(;l;){var w=l.nextSibling;l.parentNode.removeChild(l),l=w}s?(n.style.width=i+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=i+"px")}var k=new S.PluginKey("tableColumnResizing");function zt(t){t===void 0&&(t={});var e=t.handleWidth;e===void 0&&(e=5);var n=t.cellMinWidth;n===void 0&&(n=25);var r=t.View;r===void 0&&(r=ue);var a=t.lastColumnResizable;a===void 0&&(a=!0);var o=new S.Plugin({key:k,state:{init:function(s,l){return this.spec.props.nodeViews[z(l.schema).table.name]=function(f,u){return new r(f,n,u)},new K(-1,!1)},apply:function(s,l){return l.apply(s)}},props:{attributes:function(s){var l=k.getState(s);return l.activeHandle>-1?{class:"resize-cursor"}:null},handleDOMEvents:{mousemove:function(s,l){Tt(s,l,e,n,a)},mouseleave:function(s){kt(s)},mousedown:function(s,l){Dt(s,l,n)}},decorations:function(s){var l=k.getState(s);if(l.activeHandle>-1)return Et(s,l.activeHandle)},nodeViews:{}}});return o}var K=function(e,n){this.activeHandle=e,this.dragging=n};K.prototype.apply=function(e){var n=this,r=e.getMeta(k);if(r&&r.setHandle!=null)return new K(r.setHandle,null);if(r&&r.setDragging!==void 0)return new K(n.activeHandle,r.setDragging);if(n.activeHandle>-1&&e.docChanged){var a=e.mapping.map(n.activeHandle,-1);ae(e.doc.resolve(a))||(a=null),n=new K(a,n.dragging)}return n};function Tt(t,e,n,r,a){var o=k.getState(t.state);if(!o.dragging){var i=Bt(e.target),s=-1;if(i){var l=i.getBoundingClientRect(),f=l.left,u=l.right;e.clientX-f<=n?s=be(t,e,"left"):u-e.clientX<=n&&(s=be(t,e,"right"))}if(s!=o.activeHandle){if(!a&&s!==-1){var p=t.state.doc.resolve(s),d=p.node(-1),h=C.get(d),c=p.start(-1),v=h.colCount(p.pos-c)+p.nodeAfter.attrs.colspan-1;if(v==h.width-1)return}He(t,s)}}}function kt(t){var e=k.getState(t.state);e.activeHandle>-1&&!e.dragging&&He(t,-1)}function Dt(t,e,n){var r=k.getState(t.state);if(r.activeHandle==-1||r.dragging)return!1;var a=t.state.doc.nodeAt(r.activeHandle),o=Nt(t,r.activeHandle,a.attrs);t.dispatch(t.state.tr.setMeta(k,{setDragging:{startX:e.clientX,startWidth:o}}));function i(l){window.removeEventListener("mouseup",i),window.removeEventListener("mousemove",s);var f=k.getState(t.state);f.dragging&&(Ft(t,f.activeHandle,Se(f.dragging,l,n)),t.dispatch(t.state.tr.setMeta(k,{setDragging:null})))}function s(l){if(!l.which)return i(l);var f=k.getState(t.state),u=Se(f.dragging,l,n);Ht(t,f.activeHandle,u,n)}return window.addEventListener("mouseup",i),window.addEventListener("mousemove",s),e.preventDefault(),!0}function Nt(t,e,n){var r=n.colspan,a=n.colwidth,o=a&&a[a.length-1];if(o)return o;var i=t.domAtPos(e),s=i.node.childNodes[i.offset],l=s.offsetWidth,f=r;if(a)for(var u=0;u<r;u++)a[u]&&(l-=a[u],f--);return l/f}function Bt(t){for(;t&&t.nodeName!="TD"&&t.nodeName!="TH";)t=t.classList.contains("ProseMirror")?null:t.parentNode;return t}function be(t,e,n){var r=t.posAtCoords({left:e.clientX,top:e.clientY}),a=r.pos,o=E(t.state.doc.resolve(a));if(!o)return-1;if(n=="right")return o.pos;var i=C.get(o.node(-1)),s=o.start(-1),l=i.map.indexOf(o.pos-s);return l%i.width==0?-1:s+i.map[l-1]}function Se(t,e,n){var r=e.clientX-t.startX;return Math.max(n,t.startWidth+r)}function He(t,e){t.dispatch(t.state.tr.setMeta(k,{setHandle:e}))}function Ft(t,e,n){for(var r=t.state.doc.resolve(e),a=r.node(-1),o=C.get(a),i=r.start(-1),s=o.colCount(r.pos-i)+r.nodeAfter.attrs.colspan-1,l=t.state.tr,f=0;f<o.height;f++){var u=f*o.width+s;if(!(f&&o.map[u]==o.map[u-o.width])){var p=o.map[u],d=a.nodeAt(p),h=d.attrs,c=h.colspan==1?0:s-o.colCount(p);if(!(h.colwidth&&h.colwidth[c]==n)){var v=h.colwidth?h.colwidth.slice():Ot(h.colspan);v[c]=n,l.setNodeMarkup(i+p,null,R(h,"colwidth",v))}}}l.docChanged&&t.dispatch(l)}function Ht(t,e,n,r){for(var a=t.state.doc.resolve(e),o=a.node(-1),i=a.start(-1),s=C.get(o).colCount(a.pos-i)+a.nodeAfter.attrs.colspan-1,l=t.domAtPos(a.start(-1)).node;l.nodeName!="TABLE";)l=l.parentNode;Z(o,l.firstChild,l,r,s,n)}function Ot(t){for(var e=[],n=0;n<t;n++)e.push(0);return e}function Et(t,e){for(var n=[],r=t.doc.resolve(e),a=r.node(-1),o=C.get(a),i=r.start(-1),s=o.colCount(r.pos-i)+r.nodeAfter.attrs.colspan,l=0;l<o.height;l++){var f=s+l*o.width-1;if((s==o.width||o.map[f]!=o.map[f+1])&&(l==0||o.map[f-1]!=o.map[f-1-o.width])){var u=o.map[f],p=i+u+a.nodeAt(u).nodeSize-1,d=document.createElement("div");d.className="column-resize-handle",n.push(Y.Decoration.widget(p,d))}}return Y.DecorationSet.create(t.doc,n)}function Lt(t){t===void 0&&(t={});var e=t.allowTableNodeSelection;return e===void 0&&(e=!1),new S.Plugin({key:H,state:{init:function(){return null},apply:function(r,a){var o=r.getMeta(H);if(o!=null)return o==-1?null:o;if(a==null||!r.docChanged)return a;var i=r.mapping.mapResult(a),s=i.deleted,l=i.pos;return s?null:l}},props:{decorations:Ze,handleDOMEvents:{mousedown:it},createSelectionBetween:function(r){if(H.getState(r.state)!=null)return r.state.selection},handleTripleClick:ot,handleKeyDown:at,handlePaste:_e},appendTransaction:function(r,a,o){return et(o,De(o,a),e)}})}var It=m.tableEditing=Lt,Xt=m.fixTables=De;m.handlePaste=_e;m.fixTablesKey=Te;m.tableEditingKey=H;m.cellAround=E;m.isInTable=D;m.selectionCell=q;m.moveCellForward=ye;m.inSameTable=P;m.findCell=Pe;m.colCount=Qe;m.nextCell=le;var Jt=m.tableNodes=tt;m.CellSelection=b;m.TableMap=C;var Ut=m.columnResizing=zt;m.columnResizingPluginKey=k;m.updateColumnsOnResize=Z;m.__pastedCells=Me;m.__insertCells=ie;m.__clipCells=Re;m.addColumn=se;var Yt=m.addColumnBefore=ft,Gt=m.addColumnAfter=ut;m.removeColumn=Ne;var Pt=m.deleteColumn=pt;m.addRow=fe;var Qt=m.addRowBefore=ht,Zt=m.addRowAfter=ct;m.removeRow=Be;var jt=m.deleteRow=vt,$t=m.mergeCells=gt,er=m.splitCell=Ct;m.splitCellWithType=Fe;var tr=m.setCellAttr=wt;m.toggleHeader=Q;var rr=m.toggleHeaderRow=St,nr=m.toggleHeaderColumn=yt,ar=m.toggleHeaderCell=At,or=m.goToNextCell=Rt,ir=m.deleteTable=_t;export{Yt as a,Gt as b,Pt as c,m as d,Qt as e,Zt as f,jt as g,ir as h,nr as i,rr as j,ar as k,tr as l,$t as m,Xt as n,or as o,Ut as p,It as q,er as s,Jt as t};
