import{E as A,P as p,a as w,T as v}from"./prosemirror-state-d26f883c.js";import{E as C}from"./prosemirror-view-329e6b0d.js";import{d as E,c as N,D as O}from"./prosemirror-model-2d5d1d45.js";import{d as R}from"./prosemirror-dropcursor-5184b87b.js";import{g as D}from"./prosemirror-gapcursor-d7df0b38.js";import{a as y}from"./prosemirror-keymap-a3c7cf8f.js";import{s as H,b as T}from"./prosemirror-commands-9594733f.js";import{i as $,u as I}from"./prosemirror-inputrules-2a9a1b7b.js";import{m as B,g as V,n as U,a as _,b as j}from"./tiptap-utils-79441358.js";import{V as m}from"./vue-27ef7f4b.js";function J(r){return r.replace(/(?:^\w|[A-Z]|\b\w)/g,(t,e)=>e===0?t.toLowerCase():t.toUpperCase()).replace(/\s+/g,"")}class L{constructor(t,{editor:e,extension:s,parent:i,node:o,view:n,decorations:a,getPos:c}){this.component=t,this.editor=e,this.extension=s,this.parent=i,this.node=o,this.view=n,this.decorations=a,this.isNode=!!this.node.marks,this.isMark=!this.isNode,this.getPos=this.isMark?this.getMarkPos:c,this.captureEvents=!0,this.dom=this.createDOM(),this.contentDOM=this.vm.$refs.content}createDOM(){const t=m.extend(this.component),e={editor:this.editor,node:this.node,view:this.view,getPos:()=>this.getPos(),decorations:this.decorations,selected:!1,options:this.extension.options,updateAttrs:s=>this.updateAttrs(s)};return typeof this.extension.setSelection=="function"&&(this.setSelection=this.extension.setSelection),typeof this.extension.update=="function"&&(this.update=this.extension.update),this.vm=new t({parent:this.parent,propsData:e}).$mount(),this.vm.$el}update(t,e){return t.type!==this.node.type?!1:(t===this.node&&this.decorations===e||(this.node=t,this.decorations=e,this.updateComponentProps({node:t,decorations:e})),!0)}updateComponentProps(t){if(!this.vm._props)return;const e=m.config.silent;m.config.silent=!0,Object.entries(t).forEach(([s,i])=>{this.vm._props[s]=i}),m.config.silent=e}updateAttrs(t){if(!this.view.editable)return;const{state:e}=this.view,{type:s}=this.node,i=this.getPos(),o={...this.node.attrs,...t},n=this.isMark?e.tr.removeMark(i.from,i.to,s).addMark(i.from,i.to,s.create(o)):e.tr.setNodeMarkup(i,null,o);this.view.dispatch(n)}ignoreMutation(t){return t.type==="selection"?!1:this.contentDOM?!this.contentDOM.contains(t.target):!0}stopEvent(t){if(typeof this.extension.stopEvent=="function")return this.extension.stopEvent(t);const e=!!this.extension.schema.draggable;if(e&&t.type==="mousedown"){const a=t.target.closest&&t.target.closest("[data-drag-handle]");a&&(this.dom===a||this.dom.contains(a))&&(this.captureEvents=!1,document.addEventListener("dragend",()=>{this.captureEvents=!0},{once:!0}))}const s=t.type==="copy",i=t.type==="paste",o=t.type==="cut",n=t.type.startsWith("drag")||t.type==="drop";return e&&n||s||i||o?!1:this.captureEvents}selectNode(){this.updateComponentProps({selected:!0})}deselectNode(){this.updateComponentProps({selected:!1})}getMarkPos(){const t=this.view.posAtDOM(this.dom),e=this.view.state.doc.resolve(t);return j(e,this.node.type)}destroy(){this.vm.$destroy()}}class F{on(t,e){return this._callbacks=this._callbacks||{},this._callbacks[t]||(this._callbacks[t]=[]),this._callbacks[t].push(e),this}emit(t,...e){this._callbacks=this._callbacks||{};const s=this._callbacks[t];return s&&s.forEach(i=>i.apply(this,e)),this}off(t,e){if(!arguments.length)this._callbacks={};else{const s=this._callbacks?this._callbacks[t]:null;s&&(e?this._callbacks[t]=s.filter(i=>i!==e):delete this._callbacks[t])}return this}}class P{constructor(t={}){this.options={...this.defaultOptions,...t}}init(){return null}bindEditor(t=null){this.editor=t}get name(){return null}get type(){return"extension"}get defaultOptions(){return{}}get plugins(){return[]}inputRules(){return[]}pasteRules(){return[]}keys(){return{}}}class z{constructor(t=[],e){t.forEach(s=>{s.bindEditor(e),s.init()}),this.extensions=t}get nodes(){return this.extensions.filter(t=>t.type==="node").reduce((t,{name:e,schema:s})=>({...t,[e]:s}),{})}get options(){const{view:t}=this;return this.extensions.reduce((e,s)=>({...e,[s.name]:new Proxy(s.options,{set(i,o,n){const a=i[o]!==n;return Object.assign(i,{[o]:n}),a&&t.updateState(t.state),!0}})}),{})}get marks(){return this.extensions.filter(t=>t.type==="mark").reduce((t,{name:e,schema:s})=>({...t,[e]:s}),{})}get plugins(){return this.extensions.filter(t=>t.plugins).reduce((t,{plugins:e})=>[...t,...e],[])}keymaps({schema:t}){const e=this.extensions.filter(i=>["extension"].includes(i.type)).filter(i=>i.keys).map(i=>i.keys({schema:t})),s=this.extensions.filter(i=>["node","mark"].includes(i.type)).filter(i=>i.keys).map(i=>i.keys({type:t[`${i.type}s`][i.name],schema:t}));return[...e,...s].map(i=>y(i))}inputRules({schema:t,excludedExtensions:e}){if(!(e instanceof Array)&&e)return[];const s=e instanceof Array?this.extensions.filter(n=>!e.includes(n.name)):this.extensions,i=s.filter(n=>["extension"].includes(n.type)).filter(n=>n.inputRules).map(n=>n.inputRules({schema:t})),o=s.filter(n=>["node","mark"].includes(n.type)).filter(n=>n.inputRules).map(n=>n.inputRules({type:t[`${n.type}s`][n.name],schema:t}));return[...i,...o].reduce((n,a)=>[...n,...a],[])}pasteRules({schema:t,excludedExtensions:e}){if(!(e instanceof Array)&&e)return[];const s=e instanceof Array?this.extensions.filter(n=>!e.includes(n.name)):this.extensions,i=s.filter(n=>["extension"].includes(n.type)).filter(n=>n.pasteRules).map(n=>n.pasteRules({schema:t})),o=s.filter(n=>["node","mark"].includes(n.type)).filter(n=>n.pasteRules).map(n=>n.pasteRules({type:t[`${n.type}s`][n.name],schema:t}));return[...i,...o].reduce((n,a)=>[...n,...a],[])}commands({schema:t,view:e}){return this.extensions.filter(s=>s.commands).reduce((s,i)=>{const{name:o,type:n}=i,a={},c=i.commands({schema:t,...["node","mark"].includes(n)?{type:t[`${n}s`][o]}:{}}),h=(u,l)=>e.editable?(e.focus(),u(l)(e.state,e.dispatch,e)):!1,d=(u,l)=>{Array.isArray(l)?a[u]=b=>l.forEach(S=>h(S,b)):typeof l=="function"&&(a[u]=b=>h(l,b))};return typeof c=="object"?Object.entries(c).forEach(([u,l])=>{d(u,l)}):d(o,c),{...s,...a}},{})}}function K(r){{const t=document.createElement("style");t.type="text/css",t.textContent=r;const{head:e}=document,{firstChild:s}=e;s?e.insertBefore(t,s):e.appendChild(t)}}class lt extends P{constructor(t={}){super(t)}get type(){return"mark"}get view(){return null}get schema(){return null}command(){return()=>{}}}function M(r=0,t=0,e=0){return Math.min(Math.max(parseInt(r,10),t),e)}class k extends P{constructor(t={}){super(t)}get type(){return"node"}get view(){return null}get schema(){return null}command(){return()=>{}}}class W extends k{get name(){return"doc"}get schema(){return{content:"block+"}}}class q extends k{get name(){return"paragraph"}get schema(){return{content:"inline*",group:"block",draggable:!1,parseDOM:[{tag:"p"}],toDOM:()=>["p",0]}}commands({type:t}){return()=>H(t)}}class G extends k{get name(){return"text"}get schema(){return{group:"inline"}}}var Z=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}
`;class dt extends F{constructor(t={}){super(),this.defaultOptions={editorProps:{},editable:!0,autoFocus:null,extensions:[],content:"",topNode:"doc",emptyDocument:{type:"doc",content:[{type:"paragraph"}]},useBuiltInExtensions:!0,disableInputRules:!1,disablePasteRules:!1,dropCursor:{},enableDropCursor:!0,enableGapCursor:!0,parseOptions:{},injectCSS:!0,onInit:()=>{},onTransaction:()=>{},onUpdate:()=>{},onFocus:()=>{},onBlur:()=>{},onPaste:()=>{},onDrop:()=>{}},this.events=["init","transaction","update","focus","blur","paste","drop"],this.init(t)}init(t={}){this.setOptions({...this.defaultOptions,...t}),this.focused=!1,this.selection={from:0,to:0},this.element=document.createElement("div"),this.extensions=this.createExtensions(),this.nodes=this.createNodes(),this.marks=this.createMarks(),this.schema=this.createSchema(),this.plugins=this.createPlugins(),this.keymaps=this.createKeymaps(),this.inputRules=this.createInputRules(),this.pasteRules=this.createPasteRules(),this.view=this.createView(),this.commands=this.createCommands(),this.setActiveNodesAndMarks(),this.options.injectCSS&&K(Z),this.options.autoFocus!==null&&this.focus(this.options.autoFocus),this.events.forEach(e=>{this.on(e,this.options[J(`on ${e}`)]||(()=>{}))}),this.emit("init",{view:this.view,state:this.state}),this.extensions.view=this.view}setOptions(t){this.options={...this.options,...t},this.view&&this.state&&this.view.updateState(this.state)}get builtInExtensions(){return this.options.useBuiltInExtensions?[new W,new G,new q]:[]}get state(){return this.view?this.view.state:null}createExtensions(){return new z([...this.builtInExtensions,...this.options.extensions],this)}createPlugins(){return this.extensions.plugins}createKeymaps(){return this.extensions.keymaps({schema:this.schema})}createInputRules(){return this.extensions.inputRules({schema:this.schema,excludedExtensions:this.options.disableInputRules})}createPasteRules(){return this.extensions.pasteRules({schema:this.schema,excludedExtensions:this.options.disablePasteRules})}createCommands(){return this.extensions.commands({schema:this.schema,view:this.view})}createNodes(){return this.extensions.nodes}createMarks(){return this.extensions.marks}createSchema(){return new E({topNode:this.options.topNode,nodes:this.nodes,marks:this.marks})}createState(){return A.create({schema:this.schema,doc:this.createDocument(this.options.content),plugins:[...this.plugins,$({rules:this.inputRules}),...this.pasteRules,...this.keymaps,y({Backspace:I}),y(T),...this.options.enableDropCursor?[R(this.options.dropCursor)]:[],...this.options.enableGapCursor?[D()]:[],new p({key:new w("editable"),props:{editable:()=>this.options.editable}}),new p({props:{attributes:{tabindex:0},handleDOMEvents:{focus:(t,e)=>{this.focused=!0,this.emit("focus",{event:e,state:t.state,view:t});const s=this.state.tr.setMeta("focused",!0);this.view.dispatch(s)},blur:(t,e)=>{this.focused=!1,this.emit("blur",{event:e,state:t.state,view:t});const s=this.state.tr.setMeta("focused",!1);this.view.dispatch(s)}}}}),new p({props:this.options.editorProps})]})}createDocument(t,e=this.options.parseOptions){if(t===null)return this.schema.nodeFromJSON(this.options.emptyDocument);if(typeof t=="object")try{return this.schema.nodeFromJSON(t)}catch(s){return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",s),this.schema.nodeFromJSON(this.options.emptyDocument)}if(typeof t=="string"){const s=`<div>${t}</div>`,o=new window.DOMParser().parseFromString(s,"text/html").body.firstElementChild;return N.fromSchema(this.schema).parse(o,e)}return!1}createView(){return new C(this.element,{state:this.createState(),handlePaste:(...t)=>{this.emit("paste",...t)},handleDrop:(...t)=>{this.emit("drop",...t)},dispatchTransaction:this.dispatchTransaction.bind(this)})}setParentComponent(t=null){t&&this.view.setProps({nodeViews:this.initNodeViews({parent:t,extensions:[...this.builtInExtensions,...this.options.extensions]})})}initNodeViews({parent:t,extensions:e}){return e.filter(s=>["node","mark"].includes(s.type)).filter(s=>s.view).reduce((s,i)=>{const o=(n,a,c,h)=>{const d=i.view;return new L(d,{editor:this,extension:i,parent:t,node:n,view:a,getPos:c,decorations:h})};return{...s,[i.name]:o}},{})}dispatchTransaction(t){const e=this.state.apply(t);this.view.updateState(e),this.selection={from:this.state.selection.from,to:this.state.selection.to},this.setActiveNodesAndMarks(),this.emit("transaction",{getHTML:this.getHTML.bind(this),getJSON:this.getJSON.bind(this),state:this.state,transaction:t}),!(!t.docChanged||t.getMeta("preventUpdate"))&&this.emitUpdate(t)}emitUpdate(t){this.emit("update",{getHTML:this.getHTML.bind(this),getJSON:this.getJSON.bind(this),state:this.state,transaction:t})}resolveSelection(t=null){if(this.selection&&t===null)return this.selection;if(t==="start"||t===!0)return{from:0,to:0};if(t==="end"){const{doc:e}=this.state;return{from:e.content.size,to:e.content.size}}return{from:t,to:t}}focus(t=null){if(this.view.focused&&t===null||t===!1)return;const{from:e,to:s}=this.resolveSelection(t);this.setSelection(e,s),setTimeout(()=>this.view.focus(),10)}setSelection(t=0,e=0){const{doc:s,tr:i}=this.state,o=M(t,0,s.content.size),n=M(e,0,s.content.size),a=v.create(s,o,n),c=i.setSelection(a);this.view.dispatch(c)}blur(){this.view.dom.blur()}getSchemaJSON(){return JSON.parse(JSON.stringify({nodes:this.extensions.nodes,marks:this.extensions.marks}))}getHTML(){const t=document.createElement("div"),e=O.fromSchema(this.schema).serializeFragment(this.state.doc.content);return t.appendChild(e),t.innerHTML}getJSON(){return this.state.doc.toJSON()}setContent(t={},e=!1,s){const{doc:i,tr:o}=this.state,n=this.createDocument(t,s),a=v.create(i,0,i.content.size),c=o.setSelection(a).replaceSelectionWith(n,!1).setMeta("preventUpdate",!e);this.view.dispatch(c)}clearContent(t=!1){this.setContent(this.options.emptyDocument,t)}setActiveNodesAndMarks(){this.activeMarks=Object.entries(this.schema.marks).reduce((t,[e,s])=>({...t,[e]:(i={})=>B(this.state,s)}),{}),this.activeMarkAttrs=Object.entries(this.schema.marks).reduce((t,[e,s])=>({...t,[e]:V(this.state,s)}),{}),this.activeNodes=Object.entries(this.schema.nodes).reduce((t,[e,s])=>({...t,[e]:(i={})=>U(this.state,s,i)}),{})}getMarkAttrs(t=null){return this.activeMarkAttrs[t]}getNodeAttrs(t=null){return{..._(this.state,this.schema.nodes[t])}}get isActive(){return Object.entries({...this.activeMarks,...this.activeNodes}).reduce((t,[e,s])=>({...t,[e]:(i={})=>s(i)}),{})}registerPlugin(t=null,e){const s=typeof e=="function"?e(t,this.state.plugins):[t,...this.state.plugins],i=this.state.reconfigure({plugins:s});this.view.updateState(i)}unregisterPlugin(t=null){if(!t||!this.view.docView)return;const e=this.state.reconfigure({plugins:this.state.plugins.filter(s=>!s.key.startsWith(`${t}$`))});this.view.updateState(e)}destroy(){this.view&&this.view.destroy()}}var pt={props:{editor:{default:null,type:Object}},watch:{editor:{immediate:!0,handler(r){r&&r.element&&this.$nextTick(()=>{this.$el.appendChild(r.element.firstChild),r.setParentComponent(this)})}}},render(r){return r("div")},beforeDestroy(){this.editor.element=this.$el}};class Q{constructor({options:t}){this.options=t,this.preventHide=!1,this.mousedownHandler=this.handleClick.bind(this),this.options.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.blurHandler=()=>{if(this.preventHide){this.preventHide=!1;return}this.options.editor.emit("menubar:focusUpdate",!1)},this.options.editor.on("blur",this.blurHandler)}handleClick(){this.preventHide=!0}destroy(){this.options.element.removeEventListener("mousedown",this.mousedownHandler),this.options.editor.off("blur",this.blurHandler)}}function X(r){return new p({key:new w("menu_bar"),view(t){return new Q({editorView:t,options:r})}})}var mt={props:{editor:{default:null,type:Object}},data(){return{focused:!1}},watch:{editor:{immediate:!0,handler(r){r&&this.$nextTick(()=>{r.registerPlugin(X({editor:r,element:this.$el})),this.focused=r.focused,r.on("focus",()=>{this.focused=!0}),r.on("menubar:focusUpdate",t=>{this.focused=t})})}}},render(){return this.editor?this.$scopedSlots.default({focused:this.focused,focus:this.editor.focus,commands:this.editor.commands,isActive:this.editor.isActive,getMarkAttrs:this.editor.getMarkAttrs.bind(this.editor),getNodeAttrs:this.editor.getNodeAttrs.bind(this.editor)}):null}};function f(r,t,e){const s=document.createRange();return s.setEnd(r,e??r.nodeValue.length),s.setStart(r,Math.max(t,0)),s}function g(r,t){const e=r.getClientRects();return e.length?e[t<0?0:e.length-1]:r.getBoundingClientRect()}function x(r,t,e=!1){const{node:s,offset:i}=r.docView.domFromPos(t);let o,n;if(s.nodeType===3)e&&i<s.nodeValue.length?(n=g(f(s,i-1,i),-1),o="right"):i<s.nodeValue.length&&(n=g(f(s,i,i+1),-1),o="left");else if(s.firstChild){if(i<s.childNodes.length){const c=s.childNodes[i];n=g(c.nodeType===3?f(c):c,-1),o="left"}if((!n||n.top===n.bottom)&&i){const c=s.childNodes[i-1];n=g(c.nodeType===3?f(c):c,1),o="right"}}else n=s.getBoundingClientRect(),o="left";const a=n[o];return{top:n.top,bottom:n.bottom,left:a,right:a}}class Y{constructor({options:t,editorView:e}){this.options={element:null,keepInBounds:!0,onUpdate:()=>!1,...t},this.editorView=e,this.isActive=!1,this.left=0,this.bottom=0,this.top=0,this.preventHide=!1,this.mousedownHandler=this.handleClick.bind(this),this.options.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.focusHandler=({view:s})=>{this.update(s)},this.options.editor.on("focus",this.focusHandler),this.blurHandler=({event:s})=>{if(this.preventHide){this.preventHide=!1;return}this.hide(s)},this.options.editor.on("blur",this.blurHandler)}handleClick(){this.preventHide=!0}update(t,e){const{state:s}=t;if(t.composing||e&&e.doc.eq(s.doc)&&e.selection.eq(s.selection))return;if(s.selection.empty){this.hide();return}const{from:i,to:o}=s.selection,n=x(t,i),a=x(t,o,!0),c=this.options.element.offsetParent;if(!c){this.hide();return}const h=c.getBoundingClientRect(),d=this.options.element.getBoundingClientRect(),u=(n.left+a.left)/2-h.left;this.left=Math.round(this.options.keepInBounds?Math.min(h.width-d.width/2,Math.max(u,d.width/2)):u),this.bottom=Math.round(h.bottom-n.top),this.top=Math.round(a.bottom-h.top),this.isActive=!0,this.sendUpdate()}sendUpdate(){this.options.onUpdate({isActive:this.isActive,left:this.left,bottom:this.bottom,top:this.top})}hide(t){t&&t.relatedTarget&&this.options.element.parentNode&&this.options.element.parentNode.contains(t.relatedTarget)||(this.isActive=!1,this.sendUpdate())}destroy(){this.options.element.removeEventListener("mousedown",this.mousedownHandler),this.options.editor.off("focus",this.focusHandler),this.options.editor.off("blur",this.blurHandler)}}function tt(r){return new p({key:new w("menu_bubble"),view(t){return new Y({editorView:t,options:r})}})}var ft={props:{editor:{default:null,type:Object},keepInBounds:{default:!0,type:Boolean}},data(){return{menu:{isActive:!1,left:0,bottom:0}}},watch:{editor:{immediate:!0,handler(r){r&&this.$nextTick(()=>{r.registerPlugin(tt({editor:r,element:this.$el,keepInBounds:this.keepInBounds,onUpdate:t=>{t.isActive&&this.menu.isActive===!1?this.$emit("show",t):!t.isActive&&this.menu.isActive===!0&&this.$emit("hide",t),this.menu=t}}))})}}},render(){return this.editor?this.$scopedSlots.default({focused:this.editor.view.focused,focus:this.editor.focus,commands:this.editor.commands,isActive:this.editor.isActive,getMarkAttrs:this.editor.getMarkAttrs.bind(this.editor),getNodeAttrs:this.editor.getNodeAttrs.bind(this.editor),menu:this.menu}):null},beforeDestroy(){this.editor.unregisterPlugin("menu_bubble")}};export{W as D,P as E,lt as M,k as N,q as P,G as T,dt as a,mt as b,ft as c,pt as d};
