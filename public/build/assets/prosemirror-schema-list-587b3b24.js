import{c as $,R as C,l as L,a as R,f as b}from"./prosemirror-transform-7d6a52dd.js";import{F as u,S as y,a as S}from"./prosemirror-model-2d5d1d45.js";import{S as z}from"./prosemirror-state-d26f883c.js";function P(o,i=null){return function(t,r){let{$from:e,$to:l}=t.selection,n=e.blockRange(l),d=!1,s=n;if(!n)return!1;if(n.depth>=2&&e.node(n.depth-1).type.compatibleContent(o)&&n.startIndex==0){if(e.index(n.depth-1)==0)return!1;let f=t.doc.resolve(n.start-2);s=new S(f,f,n.depth),n.endIndex<n.parent.childCount&&(n=new S(e,t.doc.resolve(l.end(n.depth)),n.depth)),d=!0}let c=b(s,o,i,n);return c?(r&&r(k(t.tr,n,c,d,o).scrollIntoView()),!0):!1}}function k(o,i,t,r,e){let l=u.empty;for(let f=t.length-1;f>=0;f--)l=u.from(t[f].type.create(t[f].attrs,l));o.step(new C(i.start-(r?2:0),i.end,i.start,i.end,new y(l,0,0),t.length,!0));let n=0;for(let f=0;f<t.length;f++)t[f].type==e&&(n=f+1);let d=t.length-n,s=i.start+t.length-(r?2:0),c=i.parent;for(let f=i.startIndex,p=i.endIndex,a=!0;f<p;f++,a=!1)!a&&$(o.doc,s,d)&&(o.split(s,d),s+=2*d),s+=c.child(f).nodeSize;return o}function J(o,i){return function(t,r){let{$from:e,$to:l,node:n}=t.selection;if(n&&n.isBlock||e.depth<2||!e.sameParent(l))return!1;let d=e.node(-1);if(d.type!=o)return!1;if(e.parent.content.size==0&&e.node(-1).childCount==e.indexAfter(-1)){if(e.depth==3||e.node(-3).type!=o||e.index(-2)!=e.node(-2).childCount-1)return!1;if(r){let p=u.empty,a=e.index(-1)?1:e.index(-2)?2:3;for(let I=e.depth-a;I>=e.depth-3;I--)p=u.from(e.node(I).copy(p));let h=e.indexAfter(-1)<e.node(-2).childCount?1:e.indexAfter(-2)<e.node(-3).childCount?2:3;p=p.append(u.from(o.createAndFill()));let x=e.before(e.depth-(a-1)),m=t.tr.replace(x,e.after(-h),new y(p,4-a,0)),w=-1;m.doc.nodesBetween(x,m.doc.content.size,(I,A)=>{if(w>-1)return!1;I.isTextblock&&I.content.size==0&&(w=A+1)}),w>-1&&m.setSelection(z.near(m.doc.resolve(w))),r(m.scrollIntoView())}return!0}let s=l.pos==e.end()?d.contentMatchAt(0).defaultType:null,c=t.tr.delete(e.pos,l.pos),f=s?[i?{type:o,attrs:i}:null,{type:s}]:void 0;return $(c.doc,e.pos,2,f)?(r&&r(c.split(e.pos,2,f).scrollIntoView()),!0):!1}}function W(o){return function(i,t){let{$from:r,$to:e}=i.selection,l=r.blockRange(e,n=>n.childCount>0&&n.firstChild.type==o);return l?t?r.node(l.depth-1).type==o?v(i,t,o,l):V(i,t,l):!0:!1}}function v(o,i,t,r){let e=o.tr,l=r.end,n=r.$to.end(r.depth);l<n&&(e.step(new C(l-1,n,l,n,new y(u.from(t.create(null,r.parent.copy())),1,0),1,!0)),r=new S(e.doc.resolve(r.$from.pos),e.doc.resolve(n),r.depth));const d=L(r);if(d==null)return!1;e.lift(r,d);let s=e.mapping.map(l,-1)-1;return R(e.doc,s)&&e.join(s),i(e.scrollIntoView()),!0}function V(o,i,t){let r=o.tr,e=t.parent;for(let h=t.end,x=t.endIndex-1,m=t.startIndex;x>m;x--)h-=e.child(x).nodeSize,r.delete(h-1,h+1);let l=r.doc.resolve(t.start),n=l.nodeAfter;if(r.mapping.map(t.end)!=t.start+l.nodeAfter.nodeSize)return!1;let d=t.startIndex==0,s=t.endIndex==e.childCount,c=l.node(-1),f=l.index(-1);if(!c.canReplace(f+(d?0:1),f+1,n.content.append(s?u.empty:u.from(e))))return!1;let p=l.pos,a=p+n.nodeSize;return r.step(new C(p-(d?1:0),a+(s?1:0),p+1,a-1,new y((d?u.empty:u.from(e.copy(u.empty))).append(s?u.empty:u.from(e.copy(u.empty))),d?0:1,s?0:1),d?0:1)),i(r.scrollIntoView()),!0}function D(o){return function(i,t){let{$from:r,$to:e}=i.selection,l=r.blockRange(e,c=>c.childCount>0&&c.firstChild.type==o);if(!l)return!1;let n=l.startIndex;if(n==0)return!1;let d=l.parent,s=d.child(n-1);if(s.type!=o)return!1;if(t){let c=s.lastChild&&s.lastChild.type==d.type,f=u.from(c?o.create():null),p=new y(u.from(o.create(null,u.from(d.type.create(null,f)))),c?3:1,0),a=l.start,h=l.end;t(i.tr.step(new C(a-(c?3:1),h,a,h,p,1,!0)).scrollIntoView())}return!0}}export{D as a,W as l,J as s,P as w};
