import{r as ge}from"./prosemirror-state-d26f883c.js";import{r as Ce}from"./prosemirror-model-2d5d1d45.js";import{d as Te}from"./prosemirror-tables-c55e9af7.js";var f={};Object.defineProperty(f,"__esModule",{value:!0});var P=ge,D=Ce,d=Te,be=function(e){return function(r){var n=F(e)(r.selection);return n?te(n.pos)(r):r}},ee=function(e,r){return function(n){Array.isArray(e)||(e=[e]);for(var t=0,a=e.length;t<a;t++){var o=F(e[t])(n.selection);if(o){var l=Ae(o.pos,r)(n);if(l!==n)return l}}return n}},ye=function(e){if(k(e.selection)){var r=e.selection.$from.pos,n=e.selection.$to.pos;return m(e.delete(r,n))}return e},re=function(e){return function(r){if(k(r.selection)){var n=r.selection,t=n.$from,a=n.$to;if(e instanceof D.Fragment&&t.parent.canReplace(t.index(),t.indexAfter(),e)||t.parent.canReplaceWith(t.index(),t.indexAfter(),e.type))return m(r.replaceWith(t.pos,a.pos,e).setSelection(new P.NodeSelection(r.doc.resolve(t.pos))))}return r}},B=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return function(n){var t=P.Selection.findFrom(n.doc.resolve(e),r,!0);return t?n.setSelection(t):n}},j=function(e){return e.type&&e.type.spec.selectable},Se=function(e){return j(e)&&e.type.isLeaf},I=function(e,r,n){return Se(e)?n.setSelection(new P.NodeSelection(n.doc.resolve(r))):B(r)(n)},ne=function(e,r,n){return function(t){var a=typeof r=="number",o=t.selection.$from,l=a?t.doc.resolve(r):k(t.selection)?t.doc.resolve(o.pos+1):o,s=l.parent;if(k(t.selection)&&n){var c=t;if(t=re(e)(t),c!==t)return t}if(Oe(s)){var v=t;if(t=ee(s.type,e)(t),v!==t){var u=j(e)?l.before(l.depth):l.pos;return I(e,u,t)}}if(H(l,e)){t.insert(l.pos,e);var g=a?l.pos:j(e)?t.selection.$anchor.pos-1:t.selection.$anchor.pos;return m(I(e,g,t))}for(var h=l.depth;h>0;h--){var C=l.after(h),p=t.doc.resolve(C);if(H(p,e))return t.insert(C,e),m(I(e,C,t))}return t}},Re=function(e,r,n,t){return function(a){var o=F(e)(a.selection);return o?m(a.setNodeMarkup(o.pos,r,Object.assign({},o.node.attrs,n),t)):a}},Ne=function(e){return function(r){if(!k(r.selection)){var n=F(e)(r.selection);if(n)return m(r.setSelection(P.NodeSelection.create(r.doc,n.pos)))}return r}},we=function(e){var r=fe(e.selection);return typeof r=="number"?te(r)(e):e},k=function(e){return e instanceof P.NodeSelection},_=function(e,r){return Array.isArray(e)&&e.indexOf(r.type)>-1||r.type===e},m=function(e){return Object.assign(Object.create(e),e).setTime(Date.now())},Ae=function(e,r){return function(n){var t=n.doc.nodeAt(e),a=n.doc.resolve(e);if(Pe(a,r)){n=n.replaceWith(e,e+t.nodeSize,r);var o=n.selection.$from.pos-1;return n=B(Math.max(o,0),-1)(n),n=B(n.selection.$from.start())(n),m(n)}return n}},Pe=function(e,r){var n=e.node(e.depth);return n&&n.type.validContent(r instanceof D.Fragment?r:D.Fragment.from(r))},te=function(e){return function(r){var n=r.doc.nodeAt(e);return m(r.delete(e,e+n.nodeSize))}},G=function(e){if(e.cached.tableNodeTypes)return e.cached.tableNodeTypes;var r={};return Object.keys(e.nodes).forEach(function(n){var t=e.nodes[n];t.spec.tableRole&&(r[t.spec.tableRole]=t)}),e.cached.tableNodeTypes=r,r},H=function(e,r){var n=e.index();return r instanceof D.Fragment?e.parent.canReplace(n,n,r):r instanceof D.Node?e.parent.canReplaceWith(n,n,r.type):!1},Oe=function(e){return!e||e.type.name==="paragraph"&&e.nodeSize===2},Me=function(e){var r=function(t){return t.type.spec.tableRole&&/table/i.test(t.type.spec.tableRole)};return W(e,r)},Z=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return r?e.createChecked(null,r):e.createAndFill()},J=function(e){return function(r){for(var n=d.TableMap.get(r.$anchorCell.node(-1)),t=r.$anchorCell.start(-1),a=n.cellsInRect(e),o=n.cellsInRect(n.rectBetween(r.$anchorCell.pos-t,r.$headCell.pos-t)),l=0,s=a.length;l<s;l++)if(o.indexOf(a[l])===-1)return!1;return!0}},x=function(e){return e[0].map(function(r,n){return e.map(function(t){return t[n]})})},K=function(e){for(var r=d.TableMap.get(e),n=[],t=0;t<r.height;t++){for(var a=[],o={},l=0;l<r.width;l++){var s=r.map[t*r.width+l],c=e.nodeAt(s),v=r.findCell(s);if(o[s]||v.top!==t){a.push(null);continue}o[s]=!0,a.push(c)}n.push(a)}return n},L=function(e,r){for(var n=[],t=d.TableMap.get(e),a=0;a<t.height;a++){for(var o=e.child(a),l=[],s=0;s<t.width;s++)if(r[a][s]){var c=t.map[a*t.width+s],v=r[a][s],u=e.nodeAt(c),g=u.type.createChecked(Object.assign({},v.attrs),v.content,v.marks);l.push(g)}n.push(o.type.createChecked(o.attrs,l,o.marks))}var h=e.type.createChecked(e.attrs,n,e.marks);return h},ke=function(e,r,n,t){var a=x(K(e.node));return a=oe(a,r,n,t),a=x(a),L(e.node,a)},$e=function(e,r,n,t){var a=K(e.node);return a=oe(a,r,n,t),L(e.node,a)},oe=function(e,r,n,t){var a=r[0]>n[0]?-1:1,o=e.splice(r[0],r.length),l=o.length%2===0?1:0,s=void 0;return t===-1&&a===1?s=n[0]-1:t===1&&a===-1?s=n[n.length-1]-l+1:s=a===-1?n[0]:n[n.length-1]-l,e.splice.apply(e,[s,0].concat(o)),e},ae=function(e,r,n,t){var a=e>r?-1:1,o="Target position is invalid, you can't move the "+t+" "+e+" to "+r+", the target can't be split. You could use tryToFit option.";if(a===1){if(n.slice(0,n.length-1).indexOf(r)!==-1)throw new Error(o)}else if(n.slice(1).indexOf(r)!==-1)throw new Error(o);return!0},z=function(e){return function(r){var n=r.$from;return W(n,e)}},W=function(e,r){for(var n=e.depth;n>0;n--){var t=e.node(n);if(r(t))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:t}}},ie=function(e,r){return function(n){var t=z(e)(n);if(t)return se(t.pos,r)}},le=function(e){return function(r){return!!z(e)(r)}},F=function(e){return function(r){return z(function(n){return _(e,n)})(r)}},Ee=function(e,r){return W(e,function(n){return _(r,n)})},Be=function(e){return function(r){return le(function(n){return _(e,n)})(r)}},Fe=function(e,r){return function(n){return ie(function(t){return _(e,t)},r)(n)}},De=function(e){return function(r){if(k(r)){var n=r.node,t=r.$from;if(_(e,n))return{node:n,pos:t.pos,depth:t.depth}}}},fe=function(e){var r=e.$from.nodeBefore,n=P.Selection.findFrom(e.$from,-1);if(n&&r){var t=F(r.type)(n);return t?t.pos:n.$from.pos}},se=function(e,r){var n=r(e),t=n.node.childNodes[n.offset];return n.node.nodeType===Node.TEXT_NODE?n.node.parentNode:!t||t.nodeType===Node.TEXT_NODE?n.node:t},ue=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!e)throw new Error('Invalid "node" parameter');var n=[];return e.descendants(function(t,a){if(n.push({node:t,pos:a}),!r)return!1}),n},$=function(e,r,n){if(e){if(!r)throw new Error('Invalid "predicate" parameter')}else throw new Error('Invalid "node" parameter');return ue(e,n).filter(function(t){return r(t.node)})},_e=function(e,r){return $(e,function(n){return n.isText},r)},ze=function(e,r){return $(e,function(n){return n.isInline},r)},We=function(e,r){return $(e,function(n){return n.isBlock},r)},qe=function(e,r,n){return $(e,function(t){return!!r(t.attrs)},n)},ce=function(e,r,n){return $(e,function(t){return t.type===r},n)},Ie=function(e,r,n){return $(e,function(t){return r.isInSet(t.marks)},n)},je=function(e,r){return!!ce(e,r).length};function He(i){if(Array.isArray(i)){for(var e=0,r=Array(i.length);e<i.length;e++)r[e]=i[e];return r}else return Array.from(i)}var b=function(e){return z(function(r){return r.type.spec.tableRole&&r.type.spec.tableRole==="table"})(e)},E=function(e){return e instanceof d.CellSelection},Xe=function(e){if(E(e)){var r=e.$anchorCell.start(-1),n=d.TableMap.get(e.$anchorCell.node(-1));return n.rectBetween(e.$anchorCell.pos-r,e.$headCell.pos-r)}},Ye=function(e){return function(r){if(E(r)){var n=d.TableMap.get(r.$anchorCell.node(-1));return J({left:e,right:e+1,top:0,bottom:n.height})(r)}return!1}},Ge=function(e){return function(r){if(E(r)){var n=d.TableMap.get(r.$anchorCell.node(-1));return J({left:0,right:n.width,top:e,bottom:e+1})(r)}return!1}},Q=function(e){if(E(e)){var r=d.TableMap.get(e.$anchorCell.node(-1));return J({left:0,right:r.width,top:0,bottom:r.height})(e)}return!1},A=function(e){return function(r){var n=b(r);if(n){var t=d.TableMap.get(n.node),a=Array.isArray(e)?e:Array.from([e]);return a.reduce(function(o,l){if(l>=0&&l<=t.width-1){var s=t.cellsInRect({left:l,right:l+1,top:0,bottom:t.height});return o.concat(s.map(function(c){var v=n.node.nodeAt(c),u=c+n.start;return{pos:u,start:u+1,node:v}}))}},[])}}},w=function(e){return function(r){var n=b(r);if(n){var t=d.TableMap.get(n.node),a=Array.isArray(e)?e:Array.from([e]);return a.reduce(function(o,l){if(l>=0&&l<=t.height-1){var s=t.cellsInRect({left:0,right:t.width,top:l,bottom:l+1});return o.concat(s.map(function(c){var v=n.node.nodeAt(c),u=c+n.start;return{pos:u,start:u+1,node:v}}))}},[])}}},Je=function(e){var r=b(e);if(r){var n=d.TableMap.get(r.node),t=n.cellsInRect({left:0,right:n.width,top:0,bottom:n.height});return t.map(function(a){var o=r.node.nodeAt(a),l=a+r.start;return{pos:l,start:l+1,node:o}})}},ve=function(e){return function(r,n){return function(t){var a=b(t.selection),o=e==="row";if(a){var l=d.TableMap.get(a.node);if(r>=0&&r<(o?l.height:l.width)){var s=o?0:r,c=o?r:0,v=o?l.width:r+1,u=o?r+1:l.height;if(n){var g=U(t.selection.$from);if(!g)return t;var h=l.findCell(g.pos-a.start);o?(c=Math.min(c,h.top),u=Math.max(u,h.bottom)):(s=Math.min(s,h.left),v=Math.max(v,h.right))}var C=l.cellsInRect({left:s,top:c,right:o?v:s+1,bottom:o?c+1:u}),p=u-c===1?C:l.cellsInRect({left:o?s:v-1,top:o?u-1:c,right:v,bottom:u}),S=a.start+C[0],O=a.start+p[p.length-1],M=t.doc.resolve(S),T=t.doc.resolve(O);return m(t.setSelection(new d.CellSelection(T,M)))}}return t}}},Ke=ve("column"),Le=ve("row"),Qe=function(e){var r=b(e.selection);if(r){var n=d.TableMap.get(r.node),t=n.map;if(t&&t.length){var a=r.start+t[0],o=r.start+t[t.length-1],l=e.doc.resolve(a),s=e.doc.resolve(o);return m(e.setSelection(new d.CellSelection(s,l)))}}return e},Ue=function(e,r){return function(n){if(e){var t=G(r).cell.createAndFill(),a=t.content;if(!e.node.content.eq(a))return n.replaceWith(e.pos+1,e.pos+e.node.nodeSize,a),m(n)}return n}},Ve=function(e){return function(r){var n=b(r.selection);if(n){var t=d.TableMap.get(n.node);if(e>=0&&e<=t.width)return m(d.addColumn(r,{map:t,tableStart:n.start,table:n.node},e))}return r}},Ze=function(e,r,n){return function(t){var a={tryToFit:!1,direction:0},o=Object.assign(a,n),l=b(t.selection);if(!l)return t;var s=Y(e)(t),c=s.indexes,v=Y(r)(t),u=v.indexes;if(c.indexOf(r)>-1)return t;!o.tryToFit&&u.length>1&&ae(e,r,u,"row");var g=$e(l,c,u,o.direction);return m(t).replaceWith(l.pos,l.pos+l.node.nodeSize,g)}},xe=function(e,r,n){return function(t){var a={tryToFit:!1,direction:0},o=Object.assign(a,n),l=b(t.selection);if(!l)return t;var s=X(e)(t),c=s.indexes,v=X(r)(t),u=v.indexes;if(c.indexOf(r)>-1)return t;!o.tryToFit&&u.length>1&&ae(e,r,u,"column");var g=ke(l,c,u,o.direction);return m(t).replaceWith(l.pos,l.pos+l.node.nodeSize,g)}},er=function(e,r){return function(n){var t=b(n.selection);if(t){var a=d.TableMap.get(t.node),o=e-1;if(r&&o>=0)return m(de(o)(n));if(e>=0&&e<=a.height)return m(d.addRow(n,{map:a,tableStart:t.start,table:t.node},e))}return n}},de=function(e){return function(r){var n=b(r.selection);if(n){var t=d.TableMap.get(n.node);if(e>=0&&e<=t.height){for(var a=n.node,o=G(a.type.schema),l=n.start,s=0;s<e+1;s++)l+=a.child(s).nodeSize;var c=a.child(e),v=[],u=0;if(c.forEach(function(p){p.attrs.rowspan===1&&(u+=p.attrs.colspan,v.push(o[p.type.spec.tableRole].createAndFill(p.attrs,p.marks)))}),u<t.width){for(var g=[],h=function(S){var O=fr(S,function(M,T){var R=M.node.attrs.rowspan,N=S+R;return R>1&&N>e})(r);g.push.apply(g,He(O))},C=e;C>=0;C--)h(C);g.length&&g.forEach(function(p){r=me(p,{rowspan:p.node.attrs.rowspan+1})(r)})}return ne(o.row.create(c.attrs,v),l)(r)}}return r}},pe=function(e){return function(r){var n=b(r.selection);if(n){var t=d.TableMap.get(n.node);if(e===0&&t.width===1)return q(r);if(e>=0&&e<=t.width)return d.removeColumn(r,{map:t,tableStart:n.start,table:n.node},e),m(r)}return r}},he=function(e){return function(r){var n=b(r.selection);if(n){var t=d.TableMap.get(n.node);if(e===0&&t.height===1)return q(r);if(e>=0&&e<=t.height)return d.removeRow(r,{map:t,tableStart:n.start,table:n.node},e),m(r)}return r}},q=function(e){for(var r=e.selection.$from,n=r.depth;n>0;n--){var t=r.node(n);if(t.type.spec.tableRole==="table")return m(e.delete(r.before(n),r.after(n)))}return e},rr=function(e){var r=e.selection;if(Q(r))return q(e);if(E(r)){var n=b(r);if(n){var t=d.TableMap.get(n.node),a=t.rectBetween(r.$anchorCell.pos-n.start,r.$headCell.pos-n.start);if(a.left==0&&a.right==t.width)return!1;for(var o=Object.assign({},a,{map:t,table:n.node,tableStart:n.start}),l=o.right-1;d.removeColumn(e,o,l),l!==o.left;l--)o.table=o.tableStart?e.doc.nodeAt(o.tableStart-1):e.doc,o.map=d.TableMap.get(o.table);return m(e)}}return e},nr=function(e){var r=e.selection;if(Q(r))return q(e);if(E(r)){var n=b(r);if(n){var t=d.TableMap.get(n.node),a=t.rectBetween(r.$anchorCell.pos-n.start,r.$headCell.pos-n.start);if(a.top==0&&a.bottom==t.height)return!1;for(var o=Object.assign({},a,{map:t,table:n.node,tableStart:n.start}),l=o.bottom-1;d.removeRow(e,o,l),l!==o.top;l--)o.table=o.tableStart?e.doc.nodeAt(o.tableStart-1):e.doc,o.map=d.TableMap.get(o.table);return m(e)}}return e},tr=function(e){return function(r){var n=V(e);return n?pe(n.left)(B(e.pos)(r)):r}},or=function(e){return function(r){var n=V(e);return n?he(n.top)(B(e.pos)(r)):r}},ar=function(e,r,n){return function(t){var a=A(e)(t.selection);if(a){for(var o=a.length-1;o>=0;o--)t=r(a[o],t);if(n){var l=t.doc.resolve(t.mapping.map(a[a.length-1].pos));t.setSelection(P.Selection.near(l))}return m(t)}return t}},ir=function(e,r,n){return function(t){var a=w(e)(t.selection);if(a){for(var o=a.length-1;o>=0;o--)t=r(a[o],t);if(n){var l=t.doc.resolve(t.mapping.map(a[a.length-1].pos));t.setSelection(P.Selection.near(l))}}return t}},me=function(e,r){return function(n){return e?(n.setNodeMarkup(e.pos,null,Object.assign({},e.node.attrs,r)),m(n)):n}},lr=function(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,o=G(e),l=o.cell,s=o.header_cell,c=o.row,v=o.table,u=[],g=[],h=0;h<n;h++)u.push(Z(l,a)),t&&g.push(Z(s,a));for(var C=[],p=0;p<r;p++)C.push(c.createChecked(null,t&&p===0?g:u));return v.createChecked(null,C)},U=function(e){var r=function(t){return t.type.spec.tableRole&&/cell/i.test(t.type.spec.tableRole)};return W(e,r)},V=function(e){var r=U(e);if(r){var n=Me(e),t=d.TableMap.get(n.node),a=r.pos-n.start;return t.rectBetween(a,a)}},fr=function(e,r){return function(n){var t=[],a=w(e)(n.selection);if(a)for(var o=a.length-1;o>=0;o--)r(a[o],n)&&t.push(a[o]);return t}},X=function(e){return function(r){for(var n=e,t=e,a=function(T){var R=A(T)(r.selection);R&&R.forEach(function(N){var y=N.node.attrs.colspan+T-1;y>=n&&(n=T),y>t&&(t=y)})},o=e;o>=0;o--)a(o);for(var l=function(T){var R=A(T)(r.selection);R&&R.forEach(function(N){var y=N.node.attrs.colspan+T-1;N.node.attrs.colspan>1&&y>t&&(t=y)})},o=e;o<=t;o++)l(o);for(var s=[],o=n;o<=t;o++){var c=A(o)(r.selection);c&&c.length&&s.push(o)}n=s[0],t=s[s.length-1];for(var v=A(n)(r.selection),u=w(0)(r.selection),g=r.doc.resolve(v[v.length-1].pos),h=void 0,C=t;C>=n;C--){var p=A(C)(r.selection);if(p&&p.length){for(var S=u.length-1;S>=0;S--)if(u[S].pos===p[0].pos){h=p[0];break}if(h)break}}var O=r.doc.resolve(h.pos);return{$anchor:g,$head:O,indexes:s}}},Y=function(e){return function(r){for(var n=e,t=e,a=function(T){var R=w(T)(r.selection);R.forEach(function(N){var y=N.node.attrs.rowspan+T-1;y>=n&&(n=T),y>t&&(t=y)})},o=e;o>=0;o--)a(o);for(var l=function(T){var R=w(T)(r.selection);R.forEach(function(N){var y=N.node.attrs.rowspan+T-1;N.node.attrs.rowspan>1&&y>t&&(t=y)})},o=e;o<=t;o++)l(o);for(var s=[],o=n;o<=t;o++){var c=w(o)(r.selection);c&&c.length&&s.push(o)}n=s[0],t=s[s.length-1];for(var v=w(n)(r.selection),u=A(0)(r.selection),g=r.doc.resolve(v[v.length-1].pos),h=void 0,C=t;C>=n;C--){var p=w(C)(r.selection);if(p&&p.length){for(var S=u.length-1;S>=0;S--)if(u[S].pos===p[0].pos){h=p[0];break}if(h)break}}var O=r.doc.resolve(h.pos);return{$anchor:g,$head:O,indexes:s}}};f.isNodeSelection=k;f.canInsert=H;f.convertTableNodeToArrayOfRows=K;f.convertArrayOfRowsToTableNode=L;f.findParentNode=z;f.findParentNodeClosestToPos=W;f.findParentDomRef=ie;f.hasParentNode=le;var vr=f.findParentNodeOfType=F;f.findParentNodeOfTypeClosestToPos=Ee;f.hasParentNodeOfType=Be;f.findParentDomRefOfType=Fe;f.findSelectedNodeOfType=De;f.findPositionOfNodeBefore=fe;f.findDomRefAtPos=se;f.flatten=ue;f.findChildren=$;f.findTextNodes=_e;f.findInlineNodes=ze;f.findBlockNodes=We;f.findChildrenByAttr=qe;f.findChildrenByType=ce;f.findChildrenByMark=Ie;f.contains=je;f.findTable=b;f.isCellSelection=E;f.getSelectionRect=Xe;f.isColumnSelected=Ye;f.isRowSelected=Ge;f.isTableSelected=Q;f.getCellsInColumn=A;f.getCellsInRow=w;f.getCellsInTable=Je;f.selectColumn=Ke;f.selectRow=Le;f.selectTable=Qe;f.emptyCell=Ue;f.addColumnAt=Ve;f.moveRow=Ze;f.moveColumn=xe;f.addRowAt=er;f.cloneRowAt=de;f.removeColumnAt=pe;f.removeRowAt=he;f.removeTable=q;f.removeSelectedColumns=rr;f.removeSelectedRows=nr;f.removeColumnClosestToPos=tr;f.removeRowClosestToPos=or;f.forEachCellInColumn=ar;f.forEachCellInRow=ir;f.setCellAttrs=me;f.createTable=lr;f.findCellClosestToPos=U;f.findCellRectClosestToPos=V;f.getSelectionRangeInColumn=X;f.getSelectionRangeInRow=Y;f.removeParentNodeOfType=be;f.replaceParentNodeOfType=ee;f.removeSelectedNode=ye;f.replaceSelectedNode=re;f.setTextSelection=B;f.safeInsert=ne;f.setParentNodeMarkup=Re;f.selectParentNodeOfType=Ne;f.removeNodeBefore=we;export{vr as f};
