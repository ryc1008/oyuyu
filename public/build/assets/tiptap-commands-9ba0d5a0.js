import{s as I,l as C,w as P}from"./prosemirror-commands-9594733f.js";import{l as b,w as B}from"./prosemirror-schema-list-587b3b24.js";import{I as h}from"./prosemirror-inputrules-2a9a1b7b.js";import{P as v}from"./prosemirror-state-d26f883c.js";import{S as M,F as g}from"./prosemirror-model-2d5d1d45.js";import{b as y,n as R,f as F}from"./tiptap-utils-79441358.js";function L(t,u,o){let n=[];return o.doc.nodesBetween(t,u,(e,r)=>{n=[...n,...e.marks.map(c=>({start:r,end:r+e.nodeSize,mark:c}))]}),n}function V(t,u,o){return new h(t,(n,e,r,c)=>{const f=o instanceof Function?o(e):o,{tr:l}=n,s=e.length-1;let i=c,a=r;if(e[s]){const d=r+e[0].indexOf(e[s-1]),p=d+e[s-1].length-1,m=d+e[s-1].lastIndexOf(e[s]),k=m+e[s].length;if(L(r,c,n).filter(x=>{const{excluded:E}=x.mark.type;return E.find($=>$.name===u.name)}).filter(x=>x.end>d).length)return!1;k<p&&l.delete(k,p),m>d&&l.delete(d,m),a=d,i=a+e[s].length}return l.addMark(a,i,u.create(f)),l.removeStoredMark(u),l})}function D(t,u,o){return new h(t,(n,e,r,c)=>{const f=o instanceof Function?o(e):o,{tr:l}=n;return e[0]&&l.replaceWith(r-1,c,u.create(f)),l})}function j(t,u,o){const n=e=>{const r=[];return e.forEach(c=>{if(c.isText){const{text:f}=c;let l=0,s;do if(s=t.exec(f),s){const i=s.index,a=i+s[0].length,d=o instanceof Function?o(s[0]):o;i>0&&r.push(c.cut(l,i)),r.push(c.cut(i,a).mark(u.create(d).addToSet(c.marks))),l=a}while(s);l<f.length&&r.push(c.cut(l))}else r.push(c.copy(n(c.content)))}),g.fromArray(r)};return new v({props:{transformPasted:e=>new M(n(e.content),e.openStart,e.openEnd)}})}function q(t,u,o){const n=(e,r)=>{const c=[];return e.forEach(f=>{if(f.isText){const{text:l,marks:s}=f;let i=0,a;const d=!!s.filter(p=>p.type.name==="link")[0];for(;!d&&(a=t.exec(l))!==null;)if(r&&r.type.allowsMarkType(u)&&a[1]){const p=a.index,m=p+a[0].length,k=p+a[0].indexOf(a[1]),w=k+a[1].length,x=o instanceof Function?o(a):o;p>0&&c.push(f.cut(i,p)),c.push(f.cut(k,w).mark(u.create(x).addToSet(f.marks))),i=m}i<l.length&&c.push(f.cut(i))}else c.push(f.copy(n(f.content,f)))}),g.fromArray(c)};return new v({props:{transformPasted:e=>new M(n(e.content),e.openStart,e.openEnd)}})}function G(t){return(u,o)=>{const{tr:n,selection:e}=u;let{from:r,to:c}=e;const{$from:f,empty:l}=e;if(l){const s=y(f,t);r=s.from,c=s.to}return n.removeMark(r,c,t),o(n)}}function O(t,u,o=1,n){const e=t.resolve(u),r=e.depth-o,c=n&&n[n.length-1]||e.parent;if(r<0||e.parent.type.spec.isolating||!e.parent.canReplace(e.index(),e.parent.childCount)||!c.type.validContent(e.parent.content.cutByIndex(e.index(),e.parent.childCount)))return!1;for(let s=e.depth-1,i=o-2;s>r;s--,i--){const a=e.node(s),d=e.index(s);if(a.type.spec.isolating)return!1;let p=a.content.cutByIndex(d,a.childCount);const m=n&&n[i]||a;if(m!=a&&(p=p.replaceChild(0,m.type.create(m.attrs))),!a.canReplace(d+1,a.childCount))return!1}const f=e.indexAfter(r),l=n&&n[0];return e.node(r).canReplaceWith(f,f,l?l.type:e.node(r+1).type)}function J(t){return function(u,o){const{$from:n,$to:e,node:r}=u.selection;if(r&&r.isBlock||n.depth<2||!n.sameParent(e))return!1;const c=n.node(-1);if(c.type!=t)return!1;if(n.parent.content.size==0){if(n.depth==2||n.node(-3).type!=t||n.index(-2)!=n.node(-2).childCount-1)return!1;if(o){let i=g.empty;const a=n.index(-1)>0;for(let p=n.depth-(a?1:2);p>=n.depth-3;p--)i=g.from(n.node(p).copy(i));i=i.append(g.from(t.createAndFill()));const d=u.tr.replace(n.before(a?null:-1),n.after(-3),new M(i,a?3:2,2));d.setSelection(u.selection.constructor.near(d.doc.resolve(n.pos+(a?3:2)))),o(d.scrollIntoView())}return!0}const f=e.pos==n.end()?c.contentMatchAt(n.indexAfter(-1)).defaultType:null,l=u.tr.delete(n.pos,e.pos);let s=f&&[{type:t},{type:f}];return s||(s=[{type:t},null]),O(l.doc,n.pos,2,s)?(o&&o(l.split(n.pos,2,s).scrollIntoView()),!0):!1}}function K(t,u,o={}){return(n,e,r)=>R(n,t,o)?I(u)(n,e,r):I(t,o)(n,e,r)}function S(t,u){return t.type===u.nodes.bullet_list||t.type===u.nodes.ordered_list||t.type===u.nodes.todo_list}function Q(t,u){return(o,n,e)=>{const{schema:r,selection:c}=o,{$from:f,$to:l}=c,s=f.blockRange(l);if(!s)return!1;const i=F(a=>S(a,r))(c);if(s.depth>=1&&i&&s.depth-i.depth<=1){if(i.node.type===t)return b(u)(o,n,e);if(S(i.node,r)&&t.validContent(i.node.content)){const{tr:a}=o;return a.setNodeMarkup(i.pos,t),n&&n(a),!1}}return B(t)(o,n,e)}}function U(t,u={}){return(o,n,e)=>R(o,t,u)?C(o,n):P(t,u)(o,n,e)}function X(t,u){return(o,n)=>{const{tr:e,selection:r,doc:c}=o,{ranges:f,empty:l}=r;if(l){const{from:s,to:i}=y(r.$from,t);c.rangeHasMark(s,i,t)&&e.removeMark(s,i,t),e.addMark(s,i,t.create(u))}else f.forEach(s=>{const{$to:i,$from:a}=s;c.rangeHasMark(a.pos,i.pos,t)&&e.removeMark(a.pos,i.pos,t),e.addMark(a.pos,i.pos,t.create(u))});return n(e)}}export{Q as a,K as b,q as c,V as m,D as n,j as p,G as r,J as s,U as t,X as u};
